<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Gemini',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta property="og:type" content="website">
<meta property="og:title" content="tjjsjwhj的个人空间~">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="tjjsjwhj的个人空间~">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="tjjsjwhj">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>tjjsjwhj的个人空间~</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">tjjsjwhj的个人空间~</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">自由，从这里开始</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/27/Go-Modules-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/27/Go-Modules-md/" class="post-title-link" itemprop="url">Go Modules</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-27 19:16:55 / 修改时间：19:21:27" itemprop="dateCreated datePublished" datetime="2020-06-27T19:16:55+08:00">2020-06-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Golang/" itemprop="url" rel="index">
                    <span itemprop="name">Golang</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>In Go 1.14, module support is considered ready for production use, and all users are encouraged to migrate to modules from other dependency management systems.</p>
</blockquote>
<p>在go1.14中，模块支持被认为已经可以在生产环境中使用，因此鼓励所有用户将项目中的依赖管理系统都迁移到Go Mudules中。</p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><h3 id="Go-版本升级"><a href="#Go-版本升级" class="headerlink" title="Go 版本升级"></a>Go 版本升级</h3><p><strong>查看Go版本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go env</span><br></pre></td></tr></table></figure>

<p>如果显示版本低于1.14，则需要升级。</p>
<p><strong>下载Go最新版本</strong></p>
<p>官网地址：<a href="https://golang.org/dl/" target="_blank" rel="noopener">https://golang.org/dl/</a> ，下载对应版本。这里以 <code>go1.14.4.darwin-amd64.tar.gz</code> 为例。</p>
<p><strong>删除旧版本</strong></p>
<ul>
<li>通过 <code>go env</code> 获取安装路径（即 <code>GOROOT</code> ），一般是 <code>/usr/local/go</code> 。</li>
<li><code>rm -rf /usr/local/go</code> </li>
</ul>
<p><strong>安装新版本</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo tar -C /usr/<span class="built_in">local</span> -xzf go1.14.4.darwin-amd64.tar.gz</span><br></pre></td></tr></table></figure>

<p>至此，Go1.14 升级完成，so easy~</p>
<h3 id="设置代理"><a href="#设置代理" class="headerlink" title="设置代理"></a>设置代理</h3><p>由于一些原因，下载Go的各种依赖包的时候，速度很慢，通过一些镜像网站下载的话，可以获得如丝滑般的下载体验。</p>
<p><strong>常见的Go Modules镜像网站：</strong><br>1、<a href="https://proxy.golang.org/" target="_blank" rel="noopener">https://proxy.golang.org/</a><br>GOPROXY 的默认值，这是一个在大陆无法访问的地址。。<br>2、<a href="https://goproxy.io/" target="_blank" rel="noopener">https://goproxy.io/</a><br>一个开源的为 Go Modules 而生的全球代理。国内开发者使用的较多，维护者是个人。<br>3、<a href="https://goproxy.cn/" target="_blank" rel="noopener">https://goproxy.cn/</a><br>Goproxy 中国，最初开发者是 <a href="https://aofeisheng.com/" target="_blank" rel="noopener">@盛傲飞</a>，目前是七牛云托管和维护。你甚至可以像 goproxy.baidu.com 一样将该服务用作上游代理。</p>
<p><strong>如何设置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go env -w GO111MODULE=on</span><br><span class="line">go env -w GOPROXY=https://goproxy.cn,direct</span><br></pre></td></tr></table></figure>

<p><strong>趣闻</strong>：<a href="https://github.com/goproxy/goproxy.cn/issues/61" target="_blank" rel="noopener">goproxy.io 和 goproxy.cn 是什么关系?</a></p>
<h2 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h2><blockquote>
<p>如果使用 Go Modules 来管理依赖，那么你的项目就没有必要在 <code>GOPATH</code> 中了。</p>
</blockquote>
<h3 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h3><p>1、随便创建一个项目目录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /tmp/scratchpad/repo</span><br><span class="line"><span class="built_in">cd</span> /tmp/scratchpad/repo</span><br></pre></td></tr></table></figure>
<p>2、go mod 准备</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">go mod init xxx/repo</span><br></pre></td></tr></table></figure>
<p>其中 <code>xxx</code> 是你项目托管的目录。如果是在github上，则是 <code>github.com/yourname/repo</code> 。</p>
<p>3、测试代码</p>
<p>repo 下 main.go 中添加如下测试代码</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"net/http"</span></span><br><span class="line">	</span><br><span class="line">	<span class="string">"github.com/labstack/echo"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	e := echo.New()</span><br><span class="line">	e.GET(<span class="string">"/"</span>, <span class="function"><span class="keyword">func</span><span class="params">(c echo.Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> c.String(http.StatusOK, <span class="string">"Hello, World!"</span>)</span><br><span class="line">	&#125;)</span><br><span class="line">	e.Logger.Fatal(e.Start(<span class="string">":1323"</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4、go mod xxx 相关命令</p>
<table>
<thead>
<tr>
<th>xxx</th>
<th>解释</th>
</tr>
</thead>
<tbody><tr>
<td>download</td>
<td>download modules to local cache</td>
</tr>
<tr>
<td>edit</td>
<td>edit go.mod from tools or scripts</td>
</tr>
<tr>
<td>graph</td>
<td>print module requirement graph</td>
</tr>
<tr>
<td>init</td>
<td>initialize new module in current directory</td>
</tr>
<tr>
<td>tidy</td>
<td>add missing and remove unused modules</td>
</tr>
<tr>
<td>vendor</td>
<td>make vendored copy of dependencies</td>
</tr>
<tr>
<td>verify</td>
<td>verify dependencies have expected content</td>
</tr>
<tr>
<td>why</td>
<td>explain why packages or modules are needed</td>
</tr>
</tbody></table>
<h3 id="日常工作流程"><a href="#日常工作流程" class="headerlink" title="日常工作流程"></a>日常工作流程</h3><p>使用 go mod 之后，你的<strong>日常工作流程</strong>应该是这样：</p>
<ol>
<li>在代码文件中写好 <code>import</code> 语句</li>
<li>执行 <code>go run</code> or <code>go build</code> or <code>go test</code>，或者一些其它的标准命令时，会自动下载依赖以及更新 <code>go.mod</code> 文件。</li>
<li>当你需要指定依赖的版本的时候，你可以使用命令 <code>go get foo@v1.2.3</code>， <code>go get foo@master</code> ，<code>go get foo@e3702bed2</code> 直接下载指定版本（这些命令都会直接更新go.mod），或者直接修改 go.mod 文件。</li>
</ol>
<p>一些你可能会用到的其它功能：</p>
<ol>
<li><code>go list -m all</code> – 查看全部直接或者间接的依赖</li>
<li><code>go list -u -m all</code> – 查看全部直接或者间接的依赖版本及最新版本</li>
<li><code>go get -u ./...</code> or <code>go get -u=patch ./...</code> ,，更新全部直接或者间接依赖到最新 <code>minor</code> 版本或者 <code>patch</code> 版本</li>
<li><code>go build ./...</code> or <code>go test ./...</code></li>
<li><code>go mod tidy</code> 精简不必要的依赖，同时增加任何必要的依赖。</li>
<li><code>go mod vendor</code> — 创建 vendor 目录，并复制依赖到其中。 </li>
</ol>
<h2 id="一些基本概念"><a href="#一些基本概念" class="headerlink" title="一些基本概念"></a>一些基本概念</h2><h3 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h3><blockquote>
<p>A module is a collection of related Go packages that are versioned together as a single unit.</p>
</blockquote>
<p>仓库（repository）、模块（module）和 包（package）之间的关联：</p>
<ul>
<li>一个仓库包含了一个或多个 Go Modules</li>
<li>每个模块包含了一个或多个 Go Packages</li>
<li>每个包 包含了某个路径下的一个或多个 Go Source 文件</li>
</ul>
<p>Modules 必须被语义版本化 （遵循 <a href="https://semver.org/" target="_blank" rel="noopener">semver</a> 协议），其版本描述格式如 <code>v(major).(minor).(patch)</code> </p>
<blockquote>
<ol>
<li>major (主版本号)：当你做了不兼容的 API 修改，</li>
<li>minor (次版本号)：当你做了向下兼容的功能性新增</li>
<li>patch (修订号)：当你做了向下兼容的问题修正</li>
</ol>
</blockquote>
<h3 id="go-mod"><a href="#go-mod" class="headerlink" title="go.mod"></a>go.mod</h3><p><code>go.mod</code> 文件中有4个命令：<code>module</code>， <code>require</code>，<code>replace</code>，<code>exclude</code>。</p>
<p><strong>example</strong></p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">module github.com/my/thing</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">    github.com/some/dependency v1<span class="number">.2</span><span class="number">.3</span></span><br><span class="line">    github.com/another/dependency/v4 v4<span class="number">.0</span><span class="number">.0</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p><code>module</code> 命令声明了当前模块的名称以及导入路径。</p>
<p><code>require</code> 命令标明了当前模块所依赖的模块。</p>
<p><code>replace</code> 和 <code>exclude</code> 命令仅对当前模块生效，即 build 主模块时，其它依赖模块中的 <code>replace</code> 和 <code>exclude</code> 命令都会被忽略掉。</p>
<h3 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h3><p>如果当前模块依赖的一个模块名是 M，当你还没有将 M 添加到 <code>go.mod</code> 中的时候，如果执行 <code>go build</code> 或者 <code>go test</code> 等命令，会自动拉取 M 并将其添加到 <code>go.mod</code> 中，拉取规则如下：</p>
<ul>
<li>拉取 M 最新的发行版本 v1.2.3，如果没有发行版本，则拉取最新的master的commit</li>
<li>如果当前模块中的依赖 A 依赖 M v1.0.0，B 依赖 M v1.2.3，那么会选择 M v1.2.3 (最小版本选择算法)</li>
</ul>
<h3 id="语义导入版本控制"><a href="#语义导入版本控制" class="headerlink" title="语义导入版本控制"></a>语义导入版本控制</h3><p>这里说的是导入模块的时候，包的路径应该与模块版本相符。</p>
<p>具体规则如下：</p>
<ul>
<li>模块的版本命令应该遵从 <a href="https://semver.org/" target="_blank" rel="noopener">semver</a> 协议。</li>
<li>如果该模块的版本是 v2 或者更高，那么 <code>go.mod</code> 中声明该模块的时候，需要加上 <code>/v2</code> 的后缀，如 <code>module github.com/my/mod/v2</code> 或者 <code>require github.com/my/mod/v2 v2.0.1</code>。这种用法也被用在 <code>go get</code> 命令中，如 <code>go get github.com/my/mod/v2@v2.0.1</code></li>
</ul>
<h2 id="FAQs"><a href="#FAQs" class="headerlink" title="FAQs"></a>FAQs</h2><p><strong>1、go.mod 中模块被标记成 <code>incompatible</code> 是什么意思</strong></p>
<p><strong>答：</strong> 如果 <code>Module</code> 的名字没有遵循 Golang 的规范，即在模块名中附带版本信息，那这就是一个不规范的模块，就会提示 <code>incompatible</code>。以 <code>github.com/labstack/echo</code> 为例，如果其当前版本是 <code>v3.3.10</code> ，那么 go.mod 中会这样显示：<code>github.com/labstack/echo v3.3.10+incompatible</code> 。</p>
<p>想象一下，如果 <code>github.com/labstack/echo</code> 更新到了 <code>v4.1.1</code> ，如果你的模块依赖它，并且执行了更新全部依赖的命令会怎么样？ <code>github.com/labstack/echo</code> 会更新到 <code>v4.1.1</code>，但是根据 <a href="https://semver.org/" target="_blank" rel="noopener">semver</a> 协议，v4 是不兼容 v3 的，这个时候你的模块就会出问题。如果依赖符合规范，如 <code>github.com/labstack/echo/v3</code> ，那你更新全部依赖后，也只是将版本更新到 <code>v3.9.9</code> 或者小于 <code>v4</code> 的最大一个版本，不会出现兼容性的问题。</p>
<p>当模块的版本小于等 v1 的时候，模块名默认不需附带版本信息。</p>
<p><strong>2、为什么 <code>go mod tidy</code> 会记录 <code>inderect</code> （非直接）依赖和测试依赖？</strong></p>
<p><strong>答：</strong> <code>go mod dity</code> 会尽可能的反应出所需要的全部环境下（有可能是系统、处理器架构或者build tags）的依赖，而 <code>go build</code> 和 <code>go test</code> 仅仅是更新 <code>go.mod</code> ，添加当前环境的依赖。</p>
<p><strong>3、如何在不支持 Module 的模块 A 中导入支持 Module 的 v2+ 的 模块 B?</strong></p>
<p><strong>答：</strong> 这需要看 module B 是如何发布 v2+ module 的。</p>
<ol>
<li>如果是在主分支，在 go.mod 中通过 <code>module</code> 声明 <code>/v3</code> <ul>
<li>模块 A 中不需要修改导入路径 （即使改了编译的时候也会忽略路径中的版本信息），在 <code>GOPATH</code> 模式下运行的时候，会选择 <code>GOPATH</code> 中的模块 B 的版本编译。</li>
</ul>
</li>
<li>如果 B 是在 子目录中创建了一个 <code>./v3</code> 目录，然后将 <code>go.mod</code> 文件放在 <code>./v3</code> 中<ul>
<li>A 中使用 <code>import github.com/xxx/B/v3</code> 是没有问题的。</li>
</ul>
</li>
</ol>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><ol>
<li><a href="https://github.com/golang/go/wiki/Modules" target="_blank" rel="noopener">Go Modules 官方文档</a></li>
<li><a href="https://juejin.im/post/5d8ee2db6fb9a04e0b0d9c8b" target="_blank" rel="noopener">干货满满的 Go Modules 和 goproxy.cn</a></li>
<li><a href="https://rainbowmango.gitbook.io/go/chapter12/3-foreword/3.7-module-incompatible" target="_blank" rel="noopener">Go 专家编程-incompatible</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/21/mysql%E4%B9%8B%E7%B4%A2%E5%BC%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/21/mysql%E4%B9%8B%E7%B4%A2%E5%BC%95/" class="post-title-link" itemprop="url">MySQL之索引</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-21 16:00:28 / 修改时间：16:08:53" itemprop="dateCreated datePublished" datetime="2020-06-21T16:00:28+08:00">2020-06-21</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="为什么需要索引"><a href="#为什么需要索引" class="headerlink" title="为什么需要索引"></a>为什么需要索引</h2><p>索引就像书籍的目录一样，可以更快的查找数据。</p>
<h2 id="常见的索引模型"><a href="#常见的索引模型" class="headerlink" title="常见的索引模型"></a>常见的索引模型</h2><blockquote>
<p>innodb 索引模型选用B+树是由MySQL的应用场景（等值区间查找、插入删除等操作频繁）及机械磁盘的特点（寻址耗时）决定的。像Redis等一些Nosql数据库，他们的索引模型就是哈希表、跳表等。</p>
</blockquote>
<ul>
<li>数组<ul>
<li>等值查询很快（数组有序排列的情况下，二分查找）</li>
<li>区间查询很快</li>
<li>数据的插入删除很慢</li>
</ul>
</li>
<li>哈希表<ul>
<li>等值查询极快</li>
<li>插入删除极快</li>
<li>区间查询很慢（只能一个个的查找）</li>
</ul>
</li>
<li>搜索树（链表）<ul>
<li>二叉搜索树<ul>
<li>等值查询、区间查询很快，效率等于数组的二分查找</li>
<li>插入删除效率logN，需要树的再平衡，再平衡的效率也是logN</li>
</ul>
</li>
<li>多叉搜索树树<ul>
<li>相比于二叉树，多叉树一次寻址能取出更多的数据，能大大减少寻址次数</li>
<li>一个节点下面，叶子节点的个数取决于硬盘上数据块的大小</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>MySQL的应用场景中，等值查询和区间查询是很高频的场景，插入删除操作也十分频繁，因此综合考虑，搜索树最适合作为底层的存储引擎。又因为机械硬盘时代，磁盘寻址的时间成本很高，因此 innodb 底层的那存储引擎选用的索引模型是B+树。</p>
<p>本文后续主要介绍innodb的索引。</p>
<h2 id="Innodb中的索引"><a href="#Innodb中的索引" class="headerlink" title="Innodb中的索引"></a>Innodb中的索引</h2><h3 id="主键索引和非主键索引"><a href="#主键索引和非主键索引" class="headerlink" title="主键索引和非主键索引"></a>主键索引和非主键索引</h3><p><strong>主键索引：</strong> 主键索引的叶子结点（最后一层）存储的是数据库的行数据。</p>
<p><strong>非主键索引：</strong> 非主键索引的叶子节点（最后一层）存储的是主键索引。</p>
<p>对于一个查询操作，查询条件如果是主键索引，则直接返回结果；如果是非主键索引，则先返回主键，然后根据主键查询主键索引树，再返回结果。</p>
<p><em>查询原则：尽量使用主键索引查询。</em></p>
<h3 id="索引类别"><a href="#索引类别" class="headerlink" title="索引类别"></a>索引类别</h3><p>innodb中不同索引类别的特点如下：</p>
<ul>
<li>普通索引<ul>
<li>没有任何限制</li>
</ul>
</li>
<li>唯一索引<ul>
<li>索引列的值唯一</li>
<li>允许有空值</li>
<li>组合索引，列值必须唯一</li>
</ul>
</li>
<li>主键索引<ul>
<li>只能作用于一个列上</li>
<li>键值唯一</li>
<li>不能为空</li>
</ul>
</li>
</ul>
<p>业务上，如果只有一个索引，并且是唯一索引，可以直接用该字段建立索引（<strong>尽量使用主键索引查询原则</strong>）</p>
<h3 id="索引维护"><a href="#索引维护" class="headerlink" title="索引维护"></a>索引维护</h3><p>插入数据或者删除数据，都涉及到索引表的调整。</p>
<p>插入数据的时候，有可能会导致叶子节点数据的挪动，也可能导致数据页的分裂。(对性能的影响需要结合B+树的增删改查操作)</p>
<p>删除数据的时候，一般只是对数据标记下删除，并不会立即调整索引树，除非索引树中被删除的数据过多，浪费了大量的空间，则需要重建索引树。</p>
<p><strong>自增主键的优势</strong></p>
<ul>
<li>主键自增，索引树不需要维护主键的有序性</li>
<li>自增ID占空间较小，非主键索引树占用的空间更小</li>
</ul>
<p>索引从性能和存储上考虑，自增ID都是更好的选择。</p>
<blockquote>
<p>想象以下，一个用户信息表，如果索引选择身份证号码，那每次新增一条数据，为了保证索引有序，都有可能导致一个数据块上数据重新排列，也能导致一个数据块分裂，显然更耗时。</p>
<p>如果这个用户信息表还有其它非主键索引树，那它的叶子节点存储的都是18位的身份证号码，显然消耗的空间相较于自增ID要更多</p>
</blockquote>
<h3 id="覆盖索引"><a href="#覆盖索引" class="headerlink" title="覆盖索引"></a>覆盖索引</h3><blockquote>
<p>覆盖索引只是一种场景，或者一种现象，构造出这种现象有利于提高查询性能。</p>
</blockquote>
<p>先看一个查询的例子。如果我们有如下的一张表：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table T (</span><br><span class="line">ID int primary key,</span><br><span class="line">k int NOT NULL DEFAULT 0, </span><br><span class="line">s varchar(16) NOT NULL DEFAULT &#39;&#39;,</span><br><span class="line">index k(k))</span><br><span class="line">engine&#x3D;InnoDB;</span><br><span class="line"></span><br><span class="line">insert into T values(100,1, &#39;aa&#39;),(200,2,&#39;bb&#39;),(300,3,&#39;cc&#39;),(500,5,&#39;ee&#39;),(600,6,&#39;ff&#39;),(700,7,&#39;gg&#39;);</span><br></pre></td></tr></table></figure>

<p>如果执行如下语句，需要查询几次？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from T where k between 3 and 5;</span><br></pre></td></tr></table></figure>
<p>答：查询非主键索引树3次，回表2次。</p>
<p>同样如果执行下面的语句，需要查询几次？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id from T where k between 3 and 5;</span><br></pre></td></tr></table></figure>
<p>答：查询非主键索引树3次，不需要回表。</p>
<p>如果索引树的查询结果已经包含了我们需要的结果，不需要回表，这种情况就称为覆盖索引。<strong>覆盖索引</strong>是常用的一种性能优手段。</p>
<h3 id="联合索引和最左前缀原则"><a href="#联合索引和最左前缀原则" class="headerlink" title="联合索引和最左前缀原则"></a>联合索引和最左前缀原则</h3><p>联合索引和最左前缀原则并没有什么必然的联系，这里放在一起讨论是因为联合索引的查找过程会应用到最左前缀原则。</p>
<h4 id="最左前缀原则"><a href="#最左前缀原则" class="headerlink" title="最左前缀原则"></a>最左前缀原则</h4><blockquote>
<p>B+ 树这种索引结构，可以利用索引的“最左前缀”，来定位记录。</p>
</blockquote>
<p>查询的时候，如果查询条件是索引的最左N个字段，或者最左N个字符，都能用上索引，加快查询速度。</p>
<h4 id="如何安排联合索引的顺序"><a href="#如何安排联合索引的顺序" class="headerlink" title="如何安排联合索引的顺序"></a>如何安排联合索引的顺序</h4><p>联合索引是按照索引项的顺序建立索引的，如（A，B），建立索引的时候，是先按A排序，然后对同一个A，再按B排序，检索的顺序也是如此，先检索A，再检索B。所以建立联合索引的时候，一定要考虑索引的复用 程度。复用程度越高，越要放前面。</p>
<p>显然如果建立了联合索引（A，B），索引A是不需要单独建立索引的。</p>
<p>回到之前的覆盖索引，如果有个高频的需求是根据用户的身份证查询姓名，那有必要建立身份证号和姓名的联合索引吗？答案是不考虑索引维护的成本下是有必要的。</p>
<p>建立了身份证和姓名的联合索引之后，只需要查询联合索引树，就能直接返回查询结果而不需要回表，大大提高查询性能。</p>
<p>当然，索引的维护是有代价的。因此建立冗余的索引来实现覆盖索引就需要权衡考虑了。</p>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><p><strong>题目</strong>：对于如下表，由于历史原因，联合索引（a, b）是必须的，那这里面有不必要的索引吗？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE &#96;geek&#96; (</span><br><span class="line">  &#96;a&#96; int(11) NOT NULL,</span><br><span class="line">  &#96;b&#96; int(11) NOT NULL,</span><br><span class="line">  &#96;c&#96; int(11) NOT NULL,</span><br><span class="line">  &#96;d&#96; int(11) NOT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;a&#96;,&#96;b&#96;),</span><br><span class="line">  KEY &#96;c&#96; (&#96;c&#96;),</span><br><span class="line">  KEY &#96;ca&#96; (&#96;c&#96;,&#96;a&#96;),</span><br><span class="line">  KEY &#96;cb&#96; (&#96;c&#96;,&#96;b&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB;</span><br></pre></td></tr></table></figure>

<p><strong>答</strong>：ca是不必要的索引。</p>
<p>对于联合索引（a，b），其内部的组织是先根据a排序，再根据b排序，因此索引树c的内容其实是cab，即先根据c排序，再根据a排序，再根据b排序的一个B+数据。索引树（c，a）的叶子节点实际上是b，树的内容也是cab，和索引树c是一致的，因此ca索引树是不必要的。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/31/mysql%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/31/mysql%E4%B9%8B%E4%BA%8B%E5%8A%A1%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7/" class="post-title-link" itemprop="url">MySQL之事务的隔离性</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-31 23:22:43" itemprop="dateCreated datePublished" datetime="2020-05-31T23:22:43+08:00">2020-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-21 16:08:45" itemprop="dateModified" datetime="2020-06-21T16:08:45+08:00">2020-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一提到事务，我们就会想到事务的4个特性ACID（Atomicity、Consistency、Isolation、Durability，即原子性、一致性、隔离性和持久性）。本篇文章，主要讲的就是隔离性。</p>
<p>mysql里面并不是所有的存储引擎都支持事务，因此本文中针对事务的讨论都是基于存储引擎innodb。</p>
<h2 id="一、隔离级别"><a href="#一、隔离级别" class="headerlink" title="一、隔离级别"></a>一、隔离级别</h2><h3 id="1-1-“隔离级别”的概念"><a href="#1-1-“隔离级别”的概念" class="headerlink" title="1.1 “隔离级别”的概念"></a>1.1 “隔离级别”的概念</h3><blockquote>
<p>脏读（dirty read）: A 事务可以读到B事务未提交的数据，就叫脏读。<br>不可重复读（no-repeatable read）: 事务A开始时只能看到其它事务已经提交的修改。换句话说，事务A的两次查询可能看到不同的结果。（其它事务中途提交修改）。不可重复读针对的是单条记录。<br>幻读（phantom read）:当某个事务在读取某个范围内的记录时，另外一个事务又在该范围内插入了新的记录，当之前的事务再次读取该范围的记录时，会产生幻行（Phantom Row）。</p>
</blockquote>
<p>当数据库上有多个事务 <strong>并行执行</strong> 的时候，会出现脏读（dirty read）、不可重复读（no-repeatable read）、幻读（phanton read)的问题，为了解决这些问题，就出现了”隔离级别”的概念。</p>
<h3 id="1-2-不同的隔离级别"><a href="#1-2-不同的隔离级别" class="headerlink" title="1.2 不同的隔离级别"></a>1.2 不同的隔离级别</h3><p>在谈隔离级别之前，我们首先要直到，你隔离的越严实，效率就会越低。因此很多时候，我们需要在二者之间寻找一个平衡点。</p>
<p>标准的事务隔离级别有以下几种：</p>
<ol>
<li><strong>读未提交</strong>（read uncommited）: 一个事务还没提交时，它做的变更就能被别的事务看到。</li>
<li><strong>读提交</strong>（read commited）: 一个事务提交之后，它做的变更才会被其他事务看到。</li>
<li><strong>可重复读</strong>（repeatable read）: 一个事务执行过程中看到的数据，总是跟这个事务在启动时看到的数据是一致的。当然在可重复读隔离级别下，未提交变更对其他事务也是不可见的。</li>
<li><strong>串行化</strong>（sirializable）: 对于同一行记录，“写”会加“写锁”，“读”会加“读锁”。当出现读写锁冲突的时候，后访问的事务必须等前一个事务执行完成，才能继续执行。</li>
</ol>
<h3 id="1-3-隔离级别的修改"><a href="#1-3-隔离级别的修改" class="headerlink" title="1.3 隔离级别的修改"></a>1.3 隔离级别的修改</h3><p><strong>隔离级别的查看</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show variables like &quot;%transaction_isolation%&quot;;</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| Variable_name         | Value           |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">| transaction_isolation | REPEATABLE-READ |</span><br><span class="line">+-----------------------+-----------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure>

<p><strong>隔离级别的修改</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set [ global | session ] transaction isolation level [ Read uncommitted  | Read committed | Repeatable read | Serializable ];</span><br></pre></td></tr></table></figure>
<p>注：<code>[]</code> 表示可选。</p>
<h3 id="1-4-可重复读隔离级别的演示"><a href="#1-4-可重复读隔离级别的演示" class="headerlink" title="1.4 可重复读隔离级别的演示"></a>1.4 可重复读隔离级别的演示</h3><p>由于mysql默认的隔离级别是可重复读，因此这里就以可重复读为例进行演示，其它情况可通过修改隔离级别模拟。</p>
<p>步骤1：创建测试表，插入测试数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; create table T(c int) engine&#x3D;InnoDB;</span><br><span class="line">insert into T(c) values(1);</span><br></pre></td></tr></table></figure>

<p>步骤2：起2个事务模仿并发的情况，以下是两个事务中不同操作的执行顺序。</p>
<p><img src="https://tjjsjwhj-blog.oss-cn-beijing.aliyuncs.com/repeatable%20read.png" alt="可重复读"></p>
<p>从图中可以看到，右边的事务无论是执行 update 操作，还是提交事务，左边的事务都是看不到的。当左边的事务提交之后，再次查询，才能看到更新之后的数据。完美契合可重复读的定义：事务执行期间看到数据可事务开启时看到的数据一致。</p>
<p>其它隔离级别读者可自行实验。</p>
<p><strong>提示</strong> </p>
<ul>
<li>如果是读未提交，那在上图第5步的时候，会发现数据发生变化</li>
<li>如果是读提交，那在上图第7步的时候，会发现数据发生变化</li>
<li>如果是串行化，那在执行第4步的时候，会失败，必须等左边的事务提交，右边的事务才能继续执行。</li>
</ul>
<h3 id="1-5-事务隔离的实现"><a href="#1-5-事务隔离的实现" class="headerlink" title="1.5 事务隔离的实现"></a>1.5 事务隔离的实现</h3><p>实现上，数据库会创建一个视图，访问的时候以视图的逻辑结果为准（<strong><em>注：此视图实为一致性读视图 consistend read view，不是MySQL中特指查询结果的那个视图</em></strong>）。不同时刻启动的事务，会有不同的视图，这意味着不同视图里面的同一条数据会有不同的版本，这就是数据库多版本并发控制（MVCC）。</p>
<p>“读未提交”隔离级别下，直接读取的最新数据，没有视图的概念；”读提交”隔离级别下，事务中每次执行查询语句前，都会新建一个视图；”可重复读”隔离级别下，事务启动的时候，会创建一个视图，整个事务执行期间都用这个视图；”串行化”隔离级别下，直接用加锁的方式来避免并行访问。</p>
<p><strong>以可重复读为例:</strong></p>
<p>在可重复读隔离级别下，不同事务在启动的时候，就拍了不同的”快照”: 一个基于整个库的快照。我们先来看下这个快照是怎么实现的。</p>
<p>Innodb中每个事务都有一个transaction id，这个id是在事务开始的时候向系统申请的，是按申请顺序严格递增的。</p>
<p>数据库中的每行数据有多个版本，每一个版本都是和一个transaction id绑定的。比如分别有事务trx_id_1，trx_id_2，trx_id_3 对某行数据进行更新，更新过程中该行数据产生了3个版本v1，v2，v3，记录的时候就会这样记：（v1, trx_id_1），（v2, trx_id_2），（v3, trx_id_3）。实际存储的时候，数据库只会记录最新的记录（v3, trx_id_3）,之前的记录则是通过undo日志计算出来的。</p>
<p>有了transaction id和多版本的概念，快照的实现方式可以这样描述：</p>
<ol>
<li>InnoDB 为每个事务构造了一个<strong>数组</strong>，用来保存这个事务启动瞬间，当前正在<strong>活跃</strong>的所有事务 ID。“活跃”指的就是，启动了但还没提交。</li>
<li>数组里面事务 ID 的最小值记为低水位，当前系统里面已经创建过的事务 ID 的最大值加 1 记为高水位。(<strong>注意：这里的ID的最大值是已经创建过的所有事务ID的最大值</strong>)</li>
</ol>
<p>这个视图数组和高水位，就组成了当前事务的一致性视图（read-view）。</p>
<p>数据版本的可见性规则，就是基于数据的 trx_id 和这个一致性视图的对比结果得到的。</p>
<p>假设数据版本对应的事务id为trx_id，则可见性规则如下：</p>
<ol>
<li>如果trx_id小于低水位，则数据可见。</li>
<li>如果trx_id大于高水位，则数据不可见</li>
<li>如果trx_id在高低水位之间，有两种可能：<ol>
<li>如果trx_id在数组里，则数据不可见</li>
<li>如果trx_id不在数组里，则数据可见</li>
</ol>
</li>
</ol>
<p><strong>此外，如果是这个事务自己更新的数据，它自己还是要认的。</strong> </p>
<p>假设事务A启动的时候，当前系统中活跃的事务ID为[trx_id_1, trx_id_2, trx_id_3]，最小事务ID为trx_id_1，系统里已经创建过的事务ID的最大值加1为trx_id_max，当前数据版本为（V4，trx_id_x4）。</p>
<p>如果trx_id_x4 &gt; trx_id_max，就认为当前V4不可见，数据版本根据undolog回退到上一个版本（V3，trx_id_x3），如果trx_id_x3在高低水位之间，并且在数组里面，仍然认为V3不可见，在根据undolog回退到上一个版本(V2，trx_id_x2)，如果trx_id_x2小于低水位，认为数据可见。那么当前事务A在整个事务期间看到的这一行数据的版本都是V2。</p>
<p>而读提交的逻辑和可重复读的逻辑类似，它们最主要的区别是：</p>
<ul>
<li>在可重复读隔离级别下，只需要在事务开始的时候创建一致性视图，之后事务里的其他查询都共用这个一致性视图；</li>
<li>在读提交隔离级别下，每一个语句执行前都会重新算出一个新的视图。</li>
</ul>
<p>InnoDB 正是利用了“所有数据都有多个版本”的这个特性，实现了“秒级创建快照”的能力。</p>
<h3 id="1-5-不同隔离级别的应用场景"><a href="#1-5-不同隔离级别的应用场景" class="headerlink" title="1.5 不同隔离级别的应用场景"></a>1.5 不同隔离级别的应用场景</h3><h2 id="二、事务到底是隔离的还是非隔离的"><a href="#二、事务到底是隔离的还是非隔离的" class="headerlink" title="二、事务到底是隔离的还是非隔离的"></a>二、事务到底是隔离的还是非隔离的</h2><p>上面介绍的不同的隔离级别下看到的数据版本针对的是当前事务的操作是纯读的情况，如果当前事务事务中存在更新操作，那会是什么情况呢？</p>
<p>当然，串行化的隔离级别下，无论读写，都会加锁，并等待锁的释放，所以这种情况下和原来一样。其它三种级别下，事务执行过程中，如果出现update操作，就会应用这样一条规则：</p>
<p><strong>更新数据都是先读后写的，而这个读，只能读当前最新版本的值，称为当前读（current read）</strong></p>
<p>读未提交隔离级别下，一直都是读的最新版本值，所以这条规则实际影响的是 <strong>读提交</strong> 和 <strong>可重复读</strong>。</p>
<p>在可重复读的事务过程中，如果出现了update操作，会等其它事务的update完成，释放行锁，然后读取当前值，在执行update语句。在这之后的select语句的执行结果都是更新后的值，因为1.5中：</p>
<p><strong>此外，如果是这个事务自己更新的数据，它自己还是要认的。</strong> </p>
<h2 id="三、尽量避免使用长事务"><a href="#三、尽量避免使用长事务" class="headerlink" title="三、尽量避免使用长事务"></a>三、尽量避免使用长事务</h2><p>事务的隔离中用到一致性视图，而一致性视图需要用到回滚日志undolog。那回滚日志什么时候删除呢？答案是，在不需要的时候才删除。也就是说，系统会判断，当没有事务再需要用到这些回滚日志时，回滚日志会被删除。</p>
<p>什么时候才不需要了呢？就是当系统里没有比这个回滚日志更早的 read-view 的时候。</p>
<p>长事务意味着系统里面会存在很老的事务视图。由于这些事务随时可能访问数据库里面的任何数据，所以这个事务提交之前，数据库里面它可能用到的回滚记录都必须保留，这就会导致大量占用存储空间。除了对回滚段的影响，长事务还占用锁资源，也可能拖垮整个库。</p>
<p>因此建议总是使用 set autocommit=1, 通过显式语句的方式来启动事务(<strong>这样之前挂起的事务会被隐式提交</strong>)。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/06/2020%E5%B9%B4%E5%BA%A6%E8%A7%84%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/06/2020%E5%B9%B4%E5%BA%A6%E8%A7%84%E5%88%92/" class="post-title-link" itemprop="url">2020年度规划</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-06 01:38:37" itemprop="dateCreated datePublished" datetime="2020-05-06T01:38:37+08:00">2020-05-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>临近春节，工作上没有那么忙了，正好把2020年的年度计划整理下，定上几个小目标。</p>
<p>为了提高计划的完成度，下面制定计划的时候，会尽可能的给出相应的时间节点和比较可行的操作步骤。</p>
<h3 id="专业技能"><a href="#专业技能" class="headerlink" title="专业技能"></a>专业技能</h3><p>19年在专业技能上的完成度比较差，所以这一部分先列出来，以体现其重要性。</p>
<p>对于目前的自己来说，有两个方向，一个是后端开发，另一个是算法（NLP方向）。从行业的发展来看，后端开发的需求量大，技术更新迭代较快，但是在企业，绝大部分的开发内容都是业务逻辑实现，可替代性较强，且工作强度较大，不利于工作和生活的平衡；算法（NLP方向）的数学基础要求较高，门槛高，可替代性较弱，但是随着各种开发工具的完善，算法模型的实现难度在迅速下降，并且NLP发展到今天，已经达到了一个瓶颈，距离真正的自然语言理解还很遥远。</p>
<p>考虑到自己的兴趣点，以及2-3年之后的职业规划，我在专业技能上的目标是成为一个具有较强的开发能力的自然语言处理算法工程师（算法工程师）。</p>
<p>以此为基准，2020年的专业技能提升计划如下：</p>
<ul>
<li>开发<ul>
<li>Redis深度历险：核心原理与应用实践<ul>
<li>目标：完成该书的重读和总结</li>
<li>时间：Q1季度结束之前</li>
<li>完成形式：至少三篇技术博客</li>
</ul>
</li>
<li>Go语言编程<ul>
<li>目标：完成该书的阅读</li>
<li>时间：Q2季度结束之前</li>
<li>完成形式：至少四篇技术博客</li>
</ul>
</li>
<li>mysql<ul>
<li>目标：完成极客时间的mysql实战</li>
<li>时间：Q2季度之前</li>
<li>完成形式：至少4篇技术博客</li>
</ul>
</li>
<li>其它相关知识<ul>
<li>目标：完成工作上一些技术设计的总结</li>
<li>时间：全年</li>
<li>完成形式：至少4篇技术博客</li>
</ul>
</li>
</ul>
</li>
<li>算法（NLP）<ul>
<li>自然语言处理入门<ul>
<li>目标：每月完成一章</li>
<li>时间：2020年</li>
<li>完成形式：完整的阅读完，并且能针对其中部分章节形成4-5篇技术博客</li>
</ul>
</li>
<li>机器学习实战<ul>
<li>目标：完成整本书的代码实现</li>
<li>时间：2020年</li>
<li>完成形式：每月完成一个章节算法的github提交</li>
</ul>
</li>
<li>数据结构、算法与应用<ul>
<li>目标：用Python和Go实现相应的数据结构及算法</li>
<li>时间：2020年</li>
<li>完成形式：每2周一篇技术博库</li>
</ul>
</li>
<li>其它<ul>
<li>leetcode刷题<ul>
<li>目标：完成200道题目，每周4道题</li>
<li>时间：2020年</li>
<li>完成形式：200道题目过关</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="非核心能力"><a href="#非核心能力" class="headerlink" title="非核心能力"></a>非核心能力</h2><h3 id="投资"><a href="#投资" class="headerlink" title="投资"></a>投资</h3><h4 id="阅读"><a href="#阅读" class="headerlink" title="阅读"></a>阅读</h4><ul>
<li>逃不开的经济周期</li>
<li>哈利·布朗的永久投资组合</li>
</ul>
<h4 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h4><ul>
<li>投资实证公开</li>
<li>专业知识整理汇总，逐步形成自己系统的投资知识体系</li>
<li>开始研究量化投资，争取完成相关代码的开发</li>
</ul>
<h3 id="欧洲史"><a href="#欧洲史" class="headerlink" title="欧洲史"></a>欧洲史</h3><p>为明年去欧洲旅行提前做准备，哈哈~~</p>
<h4 id="阅读-1"><a href="#阅读-1" class="headerlink" title="阅读"></a>阅读</h4><ul>
<li>极简欧洲史</li>
<li>企鹅欧洲史</li>
</ul>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>之前写2020年规划的时候，才刚过完年来北京。回过头去看，当时指定的目标绝大部分都没有按计划执行。果然自己的自制力还是比较差。今天重新回顾了了下之前的计划，并对其中的部分内容做了删减，感觉又有动力了！</p>
<hr>
<p><strong>一个月后见进展~~</strong></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/13/mysql%E4%B9%8Bredolog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/13/mysql%E4%B9%8Bredolog/" class="post-title-link" itemprop="url">MySQL 日志之 redolog</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-13 01:55:06" itemprop="dateCreated datePublished" datetime="2020-04-13T01:55:06+08:00">2020-04-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-21 16:08:59" itemprop="dateModified" datetime="2020-06-21T16:08:59+08:00">2020-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index">
                    <span itemprop="name">MySQL</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="一、redolog-概述"><a href="#一、redolog-概述" class="headerlink" title="一、redolog 概述"></a>一、redolog 概述</h2><p><code>mysql</code> 有多种日志，每种日志都有其特定的用途。 <code>redolog</code> 是 <code>mysql</code> 存储引擎为 <code>innodb</code> 时，特有的日志。 <code>innodb</code> 是 <code>mysql</code> 最常用的存储引擎，它的事务的持久性就是通过 <code>redolog</code>保证的。</p>
<h2 id="二、redolog-介绍"><a href="#二、redolog-介绍" class="headerlink" title="二、redolog 介绍"></a>二、redolog 介绍</h2><p>为了更清晰的将 <code>redolog</code> 讲清楚，本文会围绕以下几个方面逐层展开。</p>
<ul>
<li><code>redolog</code> 是什么？</li>
<li><code>redolog</code> 存储形式</li>
<li><code>redolog</code> 是怎么产生的？</li>
<li><code>redolog</code> 的格式</li>
<li>为什么用 <code>redolog</code> 来保证事务的持久性？</li>
</ul>
<h3 id="2-1-redolog-是什么"><a href="#2-1-redolog-是什么" class="headerlink" title="2.1 redolog 是什么"></a>2.1 redolog 是什么</h3><p><code>redolog</code> 是存储引擎 <code>innodb</code> 特有的、在引擎层生成的（ <code>binlog</code> 是在 <code>server</code> 层产生的，不管用任何引擎都会生成），用于保证事务持久性的日志。 <code>redolog</code> 采用了 <code>WAL</code> ( <code>Write-Ahead Logging</code> ) 机制，即日志优先落盘，也就是说，一个事务发生之后， <code>innodb</code> 会先将数据页的变动写到 <code>redolog</code> 中，而不是实际的数据文件中，一旦 <code>redolog</code> 写入完成，就认为这个事务的操作记录完成了。之后mysql会有一套更新机制，定期的将 <code>redolog</code> 中的内容写入到数据文件中。</p>
<p>在 <code>mysql</code> 中， <code>redolog</code> 不会用来做物理上的主从复制，它主要的应用场景是 <code>crash-recovery</code> (崩溃恢复).</p>
<p>无论mysql有没有发生异常，重新启动的时候，mysql都会通过 <code>redolog</code> 恢复，确保数据没有问题。</p>
<h3 id="2-2-redolog-的存储形式"><a href="#2-2-redolog-的存储形式" class="headerlink" title="2.2 redolog 的存储形式"></a>2.2 redolog 的存储形式</h3><p>我们可以执行如下 <code>mysql</code> 命令查看 <code>redolog</code> 相关的部分信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show variables like &quot;%innodb_log%”;</span><br></pre></td></tr></table></figure>

<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">+------------------------------------+----------+</span><br><span class="line">| Variable_name                      | Value    |</span><br><span class="line">+------------------------------------+----------+</span><br><span class="line">| innodb_log_buffer_size             | 16777216 |</span><br><span class="line">| innodb_log_checksums               | ON       |</span><br><span class="line">| innodb_log_compressed_pages        | ON       |</span><br><span class="line">| innodb_log_file_size               | 50331648 |</span><br><span class="line">| innodb_log_files_in_group          | 2        |</span><br><span class="line">| innodb_log_group_home_dir          | .&#x2F;       |</span><br><span class="line">| innodb_log_spin_cpu_abs_lwm        | 80       |</span><br><span class="line">| innodb_log_spin_cpu_pct_hwm        | 50       |</span><br><span class="line">| innodb_log_wait_for_flush_spin_hwm | 400      |</span><br><span class="line">| innodb_log_write_ahead_size        | 8192     |</span><br><span class="line">+------------------------------------+----------+</span><br></pre></td></tr></table></figure>

<p>一些参数的解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">innodb_log_buffer_size: redolog缓存区的大小，即16m</span><br><span class="line">innodb_log_file_size: redolog文件的大小，即48m</span><br><span class="line">innodb_log_files_in_group: 日志文件组中文件数量</span><br><span class="line">innodb_log_group_home_dir: 日志文件组路径即 mysql&#x2F;data</span><br></pre></td></tr></table></figure>

<p>如果 <code>mysql</code> 的安装路径是默认路径，那么：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/mysql</span><br><span class="line">ls data</span><br></pre></td></tr></table></figure>

<p>形如 <code>ib_logfile0</code>、 <code>ib_logfile1</code> 之类的文件就是 <code>redolog file</code>。为什么这里会出现两个 <code>ib_logfile</code> ？这是因为 <code>redolog file</code> 其实指的是一个文件组，由多个 <code>ib_logfile</code> 合并起来共同表示。</p>
<p><img src="https://tjjsjwhj-blog.oss-cn-beijing.aliyuncs.com/redolog_checkpoint.png" alt="redolog checkpoint"></p>
<p><code>redolog</code> 的大小是在配置中设置好的，不能无限制写入。 <code>innodb</code> 采用了循环写入的方式，图中 <code>checkpoint</code> 和 <code>writepos</code> 就是用来区分哪些数据已经从日志文件中刷新到数据文件中。<code>writepos</code> -&gt; <code>checkpoint</code> 之间的数据是已经写入到数据文件中的，是可以删除的，<code>checkpoint</code> -&gt; <code>writepos</code> 之间的数据是已经写入到日志文件中，但是还没有写入到数据文件中，是不可以擦除的。</p>
<p>如果有新的数据写入到日志文件上，<code>writepos</code> 的位置就会顺时钟挪动，如果发现超过了 <code>checkpoint</code> 的位置，就会强制将一部分 <code>checkpoint</code> 右边的数据刷如磁盘中的数据文件上，然后将 <code>checkpoint</code> 顺时针移动一定的位置。</p>
<h3 id="2-3-redolog-是怎么产生的"><a href="#2-3-redolog-是怎么产生的" class="headerlink" title="2.3 redolog 是怎么产生的"></a>2.3 redolog 是怎么产生的</h3><h4 id="2-3-1-事务的执行引起-redolog-的更新"><a href="#2-3-1-事务的执行引起-redolog-的更新" class="headerlink" title="2.3.1 事务的执行引起 redolog 的更新"></a>2.3.1 事务的执行引起 redolog 的更新</h4><p><code>redolog</code> 更新的依据是事务的执行。每一次事务执行完毕之后，所引起的数据页的变化都会先写到 <code>redolog</code> 中（当然，如果事务中是先 <code>insert</code> 再 <code>delete</code>，实际不对数据页做出改变的话， <code>redolog</code> 是不会更新的）。</p>
<p><em>注：<code>innodb</code> 中 <code>insert</code> 或者 <code>update</code> 语句默认都是事务。</em></p>
<h4 id="2-3-2-redolog-的写入流程"><a href="#2-3-2-redolog-的写入流程" class="headerlink" title="2.3.2 redolog 的写入流程"></a>2.3.2 redolog 的写入流程</h4><p>并不是事务一执行，数据页就被写入到 <code>redolog</code> 中。 <code>redolog</code> 本身是文件，频繁的写文件，会导致性能的降低，所以 <code>redolog</code> 的写入流程如下，以一个 update 操作为例：</p>
<p><img src="https://tjjsjwhj-blog.oss-cn-beijing.aliyuncs.com/redolog_wiriting_process.png" alt="redolog 刷新流程"></p>
<p>在最后一步，将数据从缓存刷入文件的时候，其实中间还有一步，缓存中的数据会先刷到 <code>linux</code> 的文件缓存中，然后才会再被刷入到日志文件中。如果 <code>Linux</code> 机器忽然重启，就有可能丢失这部分数据， <code>redolog file</code> 就会更新失败。</p>
<p><code>redolog buffer</code> 何时刷入日志文件，是否需要强制刷新 <code>Linux</code> 文件缓存？ <code>innodb</code> 主要通过下面这两个参数控制：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+--------------------------------+-------+</span><br><span class="line">| Variable_name                  | Value |</span><br><span class="line">+--------------------------------+-------+</span><br><span class="line">| innodb_flush_log_at_timeout    | 1     |</span><br><span class="line">| innodb_flush_log_at_trx_commit | 1     |</span><br><span class="line">+--------------------------------+-------+</span><br></pre></td></tr></table></figure>

<p><code>innodb_flush_log_at_trx_commit</code> 配置的详细说明如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Controls the balance between strict ACID compliance for commit operations and higher performance that is possible when commit-related I&#x2F;O operations are rearranged and done in batches. You can achieve better performance by changing the default value but then you can lose transactions in a crash.</span><br><span class="line">* The default setting of 1 is required for full ACID compliance. Logs are written and flushed to disk at each transaction commit.</span><br><span class="line">* With a setting of 0, logs are written and flushed to disk once per second. Transactions for which logs have not been flushed can be lost in a crash.</span><br><span class="line">* With a setting of 2, logs are written after each transaction commit and flushed to disk once per second. Transactions for which logs have not been flushed can be lost in a crash.</span><br><span class="line">* For settings 0 and 2, once-per-second flushing is not 100% guaranteed. Flushing may occur more frequently due to DDL changes and other internal InnoDB activities that cause logs to be flushed independently of the innodb_flush_log_at_trx_commit setting, and sometimes less frequently due to scheduling issues. If logs are flushed once per second, up to one second of transactions can be lost in a crash. If logs are flushed more or less frequently than once per second, the amount of transactions that can be lost varies accordingly.</span><br><span class="line">* Log flushing frequency is controlled by innodb_flush_log_at_timeout, which allows you to set log flushing frequency to N seconds (where N is 1 ... 2700, with a default value of 1). However, any mysqld process crash can erase up to N seconds of transactions.</span><br><span class="line">* DDL changes and other internal InnoDB activities flush the log independently of the innodb_flush_log_at_trx_commit setting.</span><br><span class="line">* InnoDB crash recovery works regardless of the innodb_flush_log_at_trx_commit setting. Transactions are either applied entirely or erased entirely.</span><br></pre></td></tr></table></figure>

<p>根据上面的解释，<code>innodb_flush_log_at_trx_commit = 1</code> 时， <code>logbuffer</code> 实时刷入，且系统缓存也会实时刷入文件，此时数据库的四大特性：ACID 能够严格保证。 <code>innodb_flush_log_at_trx_commit</code> 等于其它值的时候，可以通过 <code>innodb_flush_log_at_timeout</code> 来控制缓存刷新的频率。</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_flush_log_at_timeout" target="_blank" rel="noopener">相关配置的详细解释</a></p>
<h3 id="2-4-redolog-文件格式"><a href="#2-4-redolog-文件格式" class="headerlink" title="2.4 redolog 文件格式"></a>2.4 redolog 文件格式</h3><h4 id="2-4-1-redolog-文件存储地址"><a href="#2-4-1-redolog-文件存储地址" class="headerlink" title="2.4.1 redolog 文件存储地址"></a>2.4.1 redolog 文件存储地址</h4><p>根据上文中 <code>innodb_log</code> 的配置 <code>innodb_log_group_home_dir = ./</code> (这里的当前目录即mysql的数据文件目录，如果你是安装在默认路径，一般数据文件目录为 <code>/usr/local/mysql/data</code> )，文件目录如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">drwxr-x---   12 _mysql  _mysql       384 Mar 13 00:31 #innodb_temp</span><br><span class="line">drwxr-x---    3 _mysql  _mysql        96 Apr  4 22:10 appengine_common</span><br><span class="line">-rw-r-----    1 _mysql  _mysql        56 Aug 28  2019 auto.cnf</span><br><span class="line">-rw-r-----    1 _mysql  _mysql      7062 Mar  6 20:58 binlog.000014</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       178 Mar  7 01:47 binlog.000015</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       178 Mar  7 02:10 binlog.000016</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       178 Mar  7 02:34 binlog.000017</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       178 Mar 12 11:24 binlog.000018</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       178 Mar 12 12:25 binlog.000019</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       178 Mar 13 00:31 binlog.000020</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  51286298 Apr  4 22:26 binlog.000021</span><br><span class="line">-rw-r-----    1 _mysql  _mysql       128 Mar 13 00:31 binlog.index</span><br><span class="line">-rw-------    1 _mysql  _mysql      1680 Aug 28  2019 ca-key.pem</span><br><span class="line">-rw-r--r--    1 _mysql  _mysql      1112 Aug 28  2019 ca.pem</span><br><span class="line">-rw-r--r--    1 _mysql  _mysql      1112 Aug 28  2019 client-cert.pem</span><br><span class="line">-rw-------    1 _mysql  _mysql      1680 Aug 28  2019 client-key.pem</span><br><span class="line">-rw-r-----    1 _mysql  _mysql      4110 Mar 13 00:31 ib_buffer_pool</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  50331648 Apr  4 22:26 ib_logfile0</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  50331648 Apr  4 22:26 ib_logfile1</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  12582912 Apr  4 22:26 ibdata1</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  12582912 Mar 13 00:31 ibtmp1</span><br><span class="line">drwxr-x---    8 _mysql  _mysql       256 Nov  8 23:52 mysql</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  24117248 Apr  4 22:26 mysql.ibd</span><br><span class="line">-rw-r-----    1 _mysql  _mysql     19195 Mar 13 00:31 mysqld.local.err</span><br><span class="line">-rw-r-----    1 _mysql  _mysql         4 Mar 13 00:31 mysqld.local.pid</span><br><span class="line">drwxr-x---  105 _mysql  _mysql      3360 Nov  8 23:52 performance_schema</span><br><span class="line">-rw-------    1 _mysql  _mysql      1680 Aug 28  2019 private_key.pem</span><br><span class="line">-rw-r--r--    1 _mysql  _mysql       452 Aug 28  2019 public_key.pem</span><br><span class="line">-rw-r--r--    1 _mysql  _mysql      1112 Aug 28  2019 server-cert.pem</span><br><span class="line">-rw-------    1 _mysql  _mysql      1676 Aug 28  2019 server-key.pem</span><br><span class="line">drwxr-x---    3 _mysql  _mysql        96 Nov  8 23:52 sys</span><br><span class="line">drwxr-x---    3 _mysql  _mysql        96 Mar 30 23:15 test</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  12582912 Apr  4 22:26 undo_001</span><br><span class="line">-rw-r-----    1 _mysql  _mysql  12582912 Apr  4 22:26 undo_002</span><br></pre></td></tr></table></figure>

<p>其中前缀是 <code>ib_logfile</code> 的文件就是。</p>
<p>如果你想看一下文件中的具体内容，可以通过命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">strings ib_logfile0</span><br></pre></td></tr></table></figure>

<p>大概感知一下。在文件中，我们能搜到诸如 <code>thread_id</code>，<code>space_id</code> 之类的字段。</p>
<h4 id="2-4-2-redolog-格式简介"><a href="#2-4-2-redolog-格式简介" class="headerlink" title="2.4.2 redolog 格式简介"></a>2.4.2 redolog 格式简介</h4><p>尽管一个 <code>redolog</code> 有多个文件，但是每个文件的格式是一致的，只是有一些数据只会存在第一个文件中。</p>
<p>第一个文件 <code>ib_logfile0</code> 的格式如下：</p>
<p><img src="https://tjjsjwhj-blog.oss-cn-beijing.aliyuncs.com/indb_file0_overview.png" alt="ib_logfile0"></p>
<p>从图中可以看到，日志文件中包含了文件头信息和具体的日志信息，这些日志信息分别写在每一个日志块中。</p>
<p>其它文件 <code>ib_logfile*</code> 的格式如下：</p>
<p><img src="https://tjjsjwhj-blog.oss-cn-beijing.aliyuncs.com/indb_file1_overview.png" alt="ib_logfile*"></p>
<p>其它的日志文件内容格式基本一样，主要区别在 <code>checkpoint</code> 信息（ <code>checkpoint</code> 记录的是已经更新到数据文件中的 LSN）。</p>
<p>在深刻理解 <code>checkpoint</code> 的含义前，首先需要理解 <code>LSN</code>（ <code>og sequence number</code> ）的概念。</p>
<p><strong>什么是LSN？</strong></p>
<p><code>LSN</code> 表示日志记录创建开始到特定的日志记录已经写入的字节数。 <code>mysql</code> 通过 <code>LSN</code> 来判断是否需要刷新 <code>buffer</code> 到 <code>redolog</code> 上以及是否需要将 <code>redolog</code> 写到磁盘上。<code>LSN</code> 是单调递增的。</p>
<p>以我本地的数据库为例。</p>
<p>第一步，查看 <code>innodb</code> 的状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show engine innodb status\G;</span><br></pre></td></tr></table></figure>
<p>部分结果如下(后面的数据就是 <code>LSN</code> )：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">LOG</span><br><span class="line">---</span><br><span class="line">Log sequence number          85755920</span><br><span class="line">Log buffer assigned up to    85755920</span><br><span class="line">Log buffer completed up to   85755920</span><br><span class="line">Log written up to            85755920</span><br><span class="line">Log flushed up to            85755920</span><br><span class="line">Added dirty pages up to      85755920</span><br><span class="line">Pages flushed up to          85755920</span><br><span class="line">Last checkpoint at           85755920</span><br></pre></td></tr></table></figure>

<p>然后我删除了 <code>MySQL</code> 中的一个数据库，再次查看 innodb 的状态，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">LOG</span><br><span class="line">---</span><br><span class="line">Log sequence number          85755974</span><br><span class="line">Log buffer assigned up to    85755974</span><br><span class="line">Log buffer completed up to   85755974</span><br><span class="line">Log written up to            85755974</span><br><span class="line">Log flushed up to            85755974</span><br><span class="line">Added dirty pages up to      85755974</span><br><span class="line">Pages flushed up to          85755920</span><br><span class="line">Last checkpoint at           85755920</span><br></pre></td></tr></table></figure>
<p>可以看到， <code>buffer</code> 中的 <code>LSN</code> 已经更新了，<code>redolog</code> 中日志记录的 <code>LSN</code> 也已经更新到最新，但是 <code>checkpoint</code> 还是之前的记录，因为 <code>checkpoint</code> 小于 <code>redolog</code> 最新的 <code>LSN</code> ，所以 <code>mysql</code> 认为需要将 <code>checkpoint</code> 之后的数据继续更新到数据文件中。</p>
<p>继续查看 <code>innodb</code> 的状态，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">LOG</span><br><span class="line">---</span><br><span class="line">Log sequence number          85755974</span><br><span class="line">Log buffer assigned up to    85755974</span><br><span class="line">Log buffer completed up to   85755974</span><br><span class="line">Log written up to            85755974</span><br><span class="line">Log flushed up to            85755974</span><br><span class="line">Added dirty pages up to      85755974</span><br><span class="line">Pages flushed up to          85755974</span><br><span class="line">Last checkpoint at           85755974</span><br></pre></td></tr></table></figure>

<p>这次可以看到，<code>checkpoin</code>t 已经更新成最新的 <code>LSN</code> 了，这表明之前没来的及更新到数据文件中 <code>redolog</code> 也已经更新进去了。所以最终全部的 <code>LSN</code> 是保持一致的。</p>
<p>再细的日志格式就不在这里展开了，我看的也不深，如果你想更深入的了解，一是可以去参考 <code>mysql</code> 的源码，或者参考下面的这两篇文章。</p>
<p><strong>注</strong>：这一节内容主要参考了文章 <a href="https://blog.51cto.com/wangwei007/2287431" target="_blank" rel="noopener">MySQL InnoDB redo Log 浅析</a> 和 <a href="http://mysql.taobao.org/monthly/2017/09/07/" target="_blank" rel="noopener">MySQL · 源码分析 · Innodb 引擎Redo日志存储格式简介</a>。</p>
<h3 id="2-5-为什么用-redolog-来保证事务的持久性？"><a href="#2-5-为什么用-redolog-来保证事务的持久性？" class="headerlink" title="2.5 为什么用 redolog 来保证事务的持久性？"></a>2.5 为什么用 redolog 来保证事务的持久性？</h3><blockquote>
<p>事务的持久性是指事务一旦提交就会永久生效</p>
</blockquote>
<p><code>redolog</code> 采用的机制是 <code>WAL</code> (Write-Ahead Logging) 机制，因此事务的持久性是通过日志的持久性实现的，即每次事务提交，在持久化一个数据页的时候，首先将数据页内容持久化到日志中。</p>
<p>为什么要采用 <code>WAL</code> 机制？因为将数据页写到日志中的时间要远远快于写到数据存储文件中。我们知道，<code>innodb</code> 底层的存储实现是 <code>B+Tree</code>，对数据页的寻址是通过指针决定的。如果执行多条 <code>update</code> 语句，影响的数据页在不同的磁盘块上，那么对计算机来说磁盘块的寻址会消耗很多时间；而如果是将这些数据页的变动直接写到日志文件中，因为是顺序写入，消耗的时间远远小于前者。</p>
<p>从 IO 次数来说，<code>WAL</code> 刷新是少量 IO，DaTa 刷新是大量 IO， <code>WAL</code> 刷新次数少得多；<br>从 IO 花销来说， <code>WAL</code> 刷新是连续IO，Data 刷新是随机IO， <code>WAL</code> 刷新花销小得多.</p>
<p>因此WAL机制在保证事务持久性和数据完整性的同时，成功地提升了系统性能。</p>
<p><strong>Tips</strong></p>
<p>redolog 除了用来保证事务的持久性，它所采用的 <strong>两阶段提交</strong> 机制也保证了事务的一致性。<strong>两阶段提交</strong> 涉及到 <code>binlog</code>，后续讲 <code>binlog</code> 的时候，会重点讲解下。</p>
<p>参考课程：<a href="https://time.geekbang.org/column/intro/100020801?code=rNEW29DDq73FD01HP-2AEicuNieaJ24KUQ9tYhCk1Ow%3D" target="_blank" rel="noopener">https://time.geekbang.org/column/intro/100020801?code=rNEW29DDq73FD01HP-2AEicuNieaJ24KUQ9tYhCk1Ow%3D</a></p>
<h2 id="三、结语"><a href="#三、结语" class="headerlink" title="三、结语"></a>三、结语</h2><p>相信经过上面的讲解，你应该对 <code>redolog</code> 的概念、用处有了一个清晰的认识，并且能根据不同的生产环境对相关的配置做出合适的调整。如果你希望对 <code>redolog</code> 的具体格式以及实现有更深入的理解，可以结合上文提到文章和源码继续深入了解。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/09/openssl%E5%8D%87%E7%BA%A7%E6%95%99%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/09/openssl%E5%8D%87%E7%BA%A7%E6%95%99%E7%A8%8B/" class="post-title-link" itemprop="url">openssl升级教程</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-09 01:23:21" itemprop="dateCreated datePublished" datetime="2020-01-09T01:23:21+08:00">2020-01-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-21 12:34:37" itemprop="dateModified" datetime="2020-06-21T12:34:37+08:00">2020-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/php/" itemprop="url" rel="index">
                    <span itemprop="name">php</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p><strong>openssl版本号的含义</strong></p>
<blockquote>
<p>OpenSSL version numbers are formatted as n1.n2.n3x, where n1-3 are numbers and x, if present, is one or more letters. These can change depending on the release type:</p>
<p>Major releases that change one/both of the first two digits, which can break compatibility with previous versions</p>
<p>Minor releases that change the last digit, e.g. 1.1.0 vs. 1.1.1, can and are likely to contain new features, but in a way that does not break binary compatibility. This means that an application compiled and dynamically linked with 1.1.0 does not need to be recompiled when the shared library is updated to 1.1.1. It should be noted that some features are transparent to the application such as the maximum negotiated TLS version and cipher suites, performance improvements and so on. There is no need to recompile applications to benefit from these features.</p>
<p>Letter releases, such as 1.0.2a, exclusively contain bug and security fixes and no new features.</p>
</blockquote>
<p>后面的字母表示bug的修复记录，那显然选字母越靠后，版本越稳定。</p>
<h2 id="openssl升级步骤"><a href="#openssl升级步骤" class="headerlink" title="openssl升级步骤"></a>openssl升级步骤</h2><h4 id="版本选择"><a href="#版本选择" class="headerlink" title="版本选择"></a>版本选择</h4><p><a href="https://www.openssl.org/source/" target="_blank" rel="noopener">下载地址</a></p>
<h4 id="解压编译"><a href="#解压编译" class="headerlink" title="解压编译"></a>解压编译</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar -xzf openssl-1.1.1d.tar.gz</span><br><span class="line"><span class="built_in">cd</span> openssl-1.1.1d</span><br><span class="line"><span class="comment"># --prefix是安装路径，--openssl是配置文件路径</span></span><br><span class="line">./config shared --prefix=/opt/openssl --openssldir=/usr/<span class="built_in">local</span>/ssl -D_GNU_SOURCE</span><br><span class="line">make clean</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>
<p><code>-D_GNU_SOURCE</code>并不是必须的，只有当出现错误提示 <code>&#39;pthread_mutex_recursive&#39; undeclared (first use in this function)</code> 才需要带上，这个一般是因为系统太老。(<a href="https://github.com/openssl/openssl/issues/2261" target="_blank" rel="noopener">相关问题链接</a>)</p>
<h4 id="检查动态链接"><a href="#检查动态链接" class="headerlink" title="检查动态链接"></a>检查动态链接</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ldd /opt/openssl/bin/openssl</span><br></pre></td></tr></table></figure>
<p><strong>如果提示</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">libssl.so.1.1 =&gt; not found</span><br><span class="line">libcrypto.so.1.1 =&gt; not found</span><br><span class="line">libdl.so.2 =&gt; /lib64/libdl.so.2 (0x0000003f0b300000)</span><br><span class="line">libpthread.so.0 =&gt; /lib64/tls/libpthread.so.0 (0x0000003f0b900000)</span><br><span class="line">libc.so.6 =&gt; /lib64/tls/libc.so.6 (0x0000003f0b000000)</span><br><span class="line">/lib64/ld-linux-x86-64.so.2 (0x0000003f0ae00000)</span><br></pre></td></tr></table></figure>
<p>说明 <code>libssl.so.1.1</code> 等没有链接上，执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s /opt/openssl/lib/libssl.so.1.1 /usr/lib64/libssl.so.1.1</span><br><span class="line">sudo ln -s /opt/openssl/lib/libcrypto.so.1.1 /opt/openssl/lib/libcrypto.so.1.1</span><br></pre></td></tr></table></figure>

<h4 id="测试是否安装成功"><a href="#测试是否安装成功" class="headerlink" title="测试是否安装成功"></a>测试是否安装成功</h4><p>执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/openssl/bin/openssl version</span><br></pre></td></tr></table></figure>
<p>显示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OpenSSL 1.1.1d  10 Sep 2019</span><br></pre></td></tr></table></figure>

<h2 id="PHP下升级openssl"><a href="#PHP下升级openssl" class="headerlink" title="PHP下升级openssl"></a>PHP下升级openssl</h2><p><strong>php下添加openss扩展有两种方式</strong></p>
<ol>
<li>PHP源码编译安装的时候，带上 <code>--with-openssl[=DIR]</code> ,</li>
<li>如果php已经安装完成了，不支持openssl，但是又不想重新编译，可以下载对应版本的php源码，解压进入到php/ext/openssl目录，执行 php/bin/phpize，生成configure文件，然后指定编译配置 <code>./configure --with-openssl[=DIR] --with-php-config=/php/bin/php-config</code>，<code>make</code>编译，生成 openssl.so，再在php.ini中开启即可。</li>
</ol>
<h2 id="PHP如何实现SM3签名算法？"><a href="#PHP如何实现SM3签名算法？" class="headerlink" title="PHP如何实现SM3签名算法？"></a>PHP如何实现SM3签名算法？</h2><blockquote>
<p>SM2、SMS3等加密签名算法是国密算法，openssl从1.1.1版本开始支持</p>
</blockquote>
<p>由于希望能在PHP中实现<code>SM3</code>算法，想着能否通过升级openssl的方式实现，调研了一天发现，仅通过<code>openssl</code>的升级，无法快速实现。</p>
<p><strong>原因如下</strong></p>
<blockquote>
<p>openssl1.1.1d的安装只是说在系统层面增加了openssl这个工具，安转完之后即可通过命令行的方式实现各种加密算法</p>
<p>php实现openssl扩展，其原理是通过php/ext/openssl下面的源码，编译实现从openssl工具到php中使用的加密函数的一个映射，检查php/ext/openssl下面的openssl.c文件发现，并没有包含openssl源码中实现SMS3等算法的头文件，所以不管怎么编译，生成的php下的openssl扩展都没有SM3函数</p>
</blockquote>
<p><strong>那如何实现在PHP中使用SMS3算法？</strong></p>
<ol>
<li>修改php/ext/openssl下面的代码，增加SM3等算法的映射，重新编译生成openssl.so （工程量较大，需要熟悉源码）</li>
<li>使用openssl的一个分支版本Gmssl。Gmssl在openssl的基础上实现了对一般国密算法的支持，同时提供了用于编译openssl.so的php/ext/openssl源码，编译生成openssl.so即可 (<strong>该方法尚未验证成，怀疑和PHP版本有关</strong>)</li>
<li>安装完openssl工具后，在PHP代码中直接执行linux命令：<code>echo -n &quot;abc&quot; | /opt/openssl/bin/openssl dgst -SM3</code> </li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/06/%E4%BB%B7%E5%80%BC%E6%8A%95%E8%B5%84%E7%9A%84%E5%85%B3%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/06/%E4%BB%B7%E5%80%BC%E6%8A%95%E8%B5%84%E7%9A%84%E5%85%B3%E9%94%AE/" class="post-title-link" itemprop="url">价值投资的关键</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-06 02:13:22" itemprop="dateCreated datePublished" datetime="2020-01-06T02:13:22+08:00">2020-01-06</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%95%E8%B5%84%E7%90%86%E8%B4%A2/" itemprop="url" rel="index">
                    <span itemprop="name">投资理财</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="投资中最重要的事"><a href="#投资中最重要的事" class="headerlink" title="投资中最重要的事"></a>投资中最重要的事</h2><p><strong>认知和格局</strong></p>
<p>你能看到多么大的趋势，就能看到多少机会。你接触的人和信息，决定你有着怎样的视野，以及你看到的是怎样的一个世界。</p>
<p><strong>逻辑驱动买入，逻辑驱动卖出</strong></p>
<p>不要有偏见，一切以数据、和数据推演出的逻辑为准。以前涨不涨和以后涨不涨没关系，关注涨跌背后的逻辑，不要被个股波动的表象所影响。</p>
<h2 id="能力圈原则"><a href="#能力圈原则" class="headerlink" title="能力圈原则"></a>能力圈原则</h2><p><strong>清楚自己的能力圈</strong></p>
<p>围绕真正了解的企业画一个圈，排除不合格的企业。</p>
<p><strong>能力圈在精不在多</strong></p>
<p>对自己的能力圈拉爱说，最重要的不是能力圈的范围大小，而是你如何能够确定能力圈的便捷所在。</p>
<p><strong>坚守能力圈</strong></p>
<p>明白自己到底不知道什么，固收于自己相信和了解的公司。</p>
<p><strong>如何践行能力圈原则</strong></p>
<ol>
<li>清楚自己的状态</li>
<li>把自己变成行业专家</li>
<li>识别哪些是自己看得懂的机会（时长有时候是疯狂的，但不代表我们看不懂的东西都是疯狂的）</li>
</ol>
<p>具体而言，即：</p>
<ol>
<li>清楚自己能圈而行业知识和周期（均值回归，在股票市场上的应用，就是股价长期围绕价值中暑波动，涨多了跌，跌多了涨）</li>
<li>坚持一种风格</li>
<li>左做减法（三五个行业，十几家公司）</li>
<li>坚持自己的交易准则</li>
</ol>
<h2 id="完美的投资体系"><a href="#完美的投资体系" class="headerlink" title="完美的投资体系"></a>完美的投资体系</h2><ol>
<li>正确的方向和理念</li>
<li>寻找和听取能力圈公司的各种负面问题（好的公司、以及诚实的管理层非常稀缺，对于重仓持有的公司，我们尤其要挺别人的犀利观点，尤其是那些不看好的、负面的）</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/05/two-sum(%E4%B8%80)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/05/two-sum(%E4%B8%80)/" class="post-title-link" itemprop="url">two sum问题(-)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-05 14:20:54" itemprop="dateCreated datePublished" datetime="2020-01-05T14:20:54+08:00">2020-01-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-06 01:47:26" itemprop="dateModified" datetime="2020-05-06T01:47:26+08:00">2020-05-06</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/leetcode/" itemprop="url" rel="index">
                    <span itemprop="name">leetcode</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>两数之和问题，简而言之就是从数组中找到两个数的和等于某个特定的值，考察的主要思想是空间换时间。同时它还有许多变种，如三数之和、四数之和问题。</p>
</blockquote>
<h2 id="题目集合"><a href="#题目集合" class="headerlink" title="题目集合"></a>题目集合</h2><p><strong>two sum及其变种如下</strong>：</p>
<table>
<thead>
<tr>
<th align="center">题目</th>
<th align="center">难度等级</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><a href="https://leetcode.com/problems/two-sum/" target="_blank" rel="noopener">two sum</a></td>
<td align="center">easy</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><a href="https://leetcode.com/problems/two-sum-ii-input-array-is-sorted/" target="_blank" rel="noopener">Two Sum II - Input array is sorted</a></td>
<td align="center">easy</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><a href="https://leetcode.com/problems/two-sum-iii-data-structure-design/" target="_blank" rel="noopener">Two Sum III - Data structure design</a></td>
<td align="center">easy</td>
<td align="center">要订阅，暂时放弃。。。</td>
</tr>
<tr>
<td align="center"><a href="https://leetcode.com/problems/subarray-sum-equals-k/" target="_blank" rel="noopener">Subarray Sum Equals K</a></td>
<td align="center">medium</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><a href="https://leetcode.com/problems/two-sum-iv-input-is-a-bst/" target="_blank" rel="noopener">Two Sum IV - Input is a BST</a></td>
<td align="center">easy</td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><a href="https://leetcode.com/problems/two-sum-less-than-k/" target="_blank" rel="noopener">Two Sum Less Than K</a></td>
<td align="center">easy</td>
<td align="center"></td>
</tr>
</tbody></table>
<h3 id="1、经典原题-two-sum"><a href="#1、经典原题-two-sum" class="headerlink" title="1、经典原题: two sum"></a>1、经典原题: two sum</h3><blockquote>
<p>Given an array of integers, return indices of the two numbers such that they add up to a specific target.</p>
<p>You may assume that each input would have exactly one solution, and you may not use the same element twice.</p>
</blockquote>
<p><strong>Example</strong></p>
<blockquote>
<p>Given nums = [2, 7, 11, 15], target = 9,</p>
<p>Because nums[0] + nums[1] = 2 + 7 = 9,<br>return [0, 1].</p>
</blockquote>
<h4 id="解法一：暴力破解"><a href="#解法一：暴力破解" class="headerlink" title="解法一：暴力破解"></a>解法一：暴力破解</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> j := i + <span class="number">1</span>; j &lt; <span class="built_in">len</span>(nums); j++ &#123;</span><br><span class="line">            <span class="keyword">if</span> nums[i]+nums[j] == target &#123;</span><br><span class="line">                <span class="keyword">return</span> []<span class="keyword">int</span>&#123;i, j&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>runtime distribution</strong></p>
<blockquote>
<p>Runtime: 36 ms, faster than <strong>31.90%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p><strong>memory distribution</strong></p>
<blockquote>
<p>Memory Usage: 3 MB, less than <strong>100.00%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p><strong>思考</strong></p>
<blockquote>
<p>暴力破解是最容易想到的方法，它的时间复杂度是O(n^2)。虽然很多时候我们都对暴力解法嗤之以鼻，但是从上面的时间分布和内存分布看，优点还是很明显的，即内存消耗很小。</p>
<p>在计算机里面，增加内存的成本远远小于提高计算能力的成本，所以我们需要考虑如何通过空间来换时间。</p>
</blockquote>
<h4 id="解法二：哈希表法"><a href="#解法二：哈希表法" class="headerlink" title="解法二：哈希表法"></a>解法二：哈希表法</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> numsMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        numsMap[nums[i]] = i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        j, ok := numsMap[target - nums[i]]</span><br><span class="line">        <span class="keyword">if</span> ok &amp;&amp; j != i &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="keyword">int</span>&#123;i, j&#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>runtime distribution</strong></p>
<blockquote>
<p>Runtime: 4 ms, faster than <strong>95.00%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p><strong>memory distribution</strong></p>
<blockquote>
<p>Memory Usage: 3.8 MB, less than <strong>11.54%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p>如果把代码中numsMap的定义改成：</p>
<figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numsMap = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="built_in">len</span>(nums))</span><br></pre></td></tr></table></figure>

<p><strong>memory distribution</strong></p>
<blockquote>
<p>Memory Usage: 3.4 MB, less than <strong>42.31%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p><strong>思考</strong></p>
<blockquote>
<p>暴力解法中，比较耗时的操作是第二个for循环，第二个for循环的作用是判断第二个数加第一个数是不是等于目标值，这是一个凑数的过程。如果我们反过来想，在已知第一个数的情况下，判断我们需要找的数是不是在剩下的数的集合里面，时间复杂度就变成了O(1)。</p>
<p>从时间分布看，超过了95%的人(说明还能继续优化)；从内存分布看，只超过了11.54%的人。但是如果在初始化numsMap的时候指定了长度，消耗的内存就会少0.4M，由此可见，Go中map类型数据指定长度初始化是有必要的。</p>
<p>这里面需要注意的是，如果数组中有两个元素一致，那哈西表中存的索引就是第二个元素的索引值。但是因为我们是从前往后遍历的，所以结果不影响。至于有三个及以上的元素相同的情况是不用考虑的，因为题目说只有唯一解。</p>
</blockquote>
<h4 id="解法三：哈希表法升级版"><a href="#解法三：哈希表法升级版" class="headerlink" title="解法三：哈希表法升级版"></a>解法三：哈希表法升级版</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    numsMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="built_in">len</span>(nums))</span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        <span class="keyword">if</span> pre, ok := numsMap[target - v]; ok &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="keyword">int</span>&#123;pre, i&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        numsMap[v] = i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>runtime distribution</strong></p>
<blockquote>
<p>Runtime: 4 ms, faster than <strong>95.00%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p><strong>memory distribution</strong></p>
<blockquote>
<p>Memory Usage: 3.4 MB, less than <strong>48.08%</strong> of Go online submissions for Two Sum.</p>
</blockquote>
<p><strong>思考</strong></p>
<blockquote>
<p>解法二中，出现了两个遍历，一次是numsMap赋值的时候，一次是查找的时候。但实际上这两次是可以合并的，即一边赋值，一边查找。</p>
<p>至于为什么runtime排名还是小于<strong>95%</strong>，应该是网站的bug，时间最少的那个人的耗时是0ms，显然不可能。测试发现，如果重复提交多次，有可能出现这种情况。</p>
</blockquote>
<h3 id="2、变种一：Two-Sum-II-Input-array-is-sorted"><a href="#2、变种一：Two-Sum-II-Input-array-is-sorted" class="headerlink" title="2、变种一：Two Sum II - Input array is sorted"></a>2、变种一：Two Sum II - Input array is sorted</h3><blockquote>
<p>Given an array of integers that is already sorted in ascending order, find two numbers such that they add up to a specific target number.</p>
<p>The function twoSum should return indices of the two numbers such that they add up to the target, where index1 must be less than index2.</p>
</blockquote>
<p><strong>Note:</strong></p>
<blockquote>
<p>Your returned answers (both index1 and index2) are not zero-based.</p>
<p>You may assume that each input would have exactly one solution and you may not use the same element twice.</p>
</blockquote>
<p><strong>Examples</strong></p>
<blockquote>
<p><strong>Input:</strong> numbers = [2,7,11,15], target = 9<br><strong>Output:</strong> [1,2]<br><strong>Explanation:</strong> The sum of 2 and 7 is 9. Therefore index1 = 1, index2 = 2.</p>
</blockquote>
<h4 id="解法"><a href="#解法" class="headerlink" title="解法"></a>解法</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">twoSum</span><span class="params">(numbers []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    i := <span class="number">0</span></span><br><span class="line">    j := <span class="built_in">len</span>(numbers) - <span class="number">1</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i &lt; j &#123;</span><br><span class="line">        <span class="keyword">if</span> numbers[i] + numbers[j] == target &#123;</span><br><span class="line">            <span class="keyword">return</span> []<span class="keyword">int</span>&#123;i+<span class="number">1</span>, j+<span class="number">1</span>&#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> numbers[i] + numbers[j] &gt; target &#123;</span><br><span class="line">            j--</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>思考</strong></p>
<blockquote>
<p>这个变种比较简单，数据按升序排好，只需要使用双指针，向中间靠拢即可</p>
</blockquote>
<h3 id="变种二：Two-Sum-IV-Input-is-a-BST"><a href="#变种二：Two-Sum-IV-Input-is-a-BST" class="headerlink" title="变种二：Two Sum IV - Input is a BST"></a>变种二：Two Sum IV - Input is a BST</h3><blockquote>
<p>Given a Binary Search Tree and a target number, return true if there exist two elements in the BST such that their sum is equal to the given target.</p>
</blockquote>
<p><strong>Example:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">    5</span><br><span class="line">   &#x2F; \</span><br><span class="line">  3   6</span><br><span class="line"> &#x2F; \   \</span><br><span class="line">2   4   7</span><br><span class="line"></span><br><span class="line">Target &#x3D; 9</span><br><span class="line"></span><br><span class="line">Output: True</span><br></pre></td></tr></table></figure>

<h4 id="解法一"><a href="#解法一" class="headerlink" title="解法一"></a>解法一</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *     Val int</span></span><br><span class="line"><span class="comment"> *     Left *TreeNode</span></span><br><span class="line"><span class="comment"> *     Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findTarget</span><span class="params">(root *TreeNode, k <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	list := printTree(root)</span><br><span class="line">	hashSet := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(list); i++ &#123;</span><br><span class="line">		except := k - list[i]</span><br><span class="line">		<span class="keyword">if</span> hashSet[except] == <span class="number">1</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">		&#125;</span><br><span class="line">        hashSet[list[i]] = <span class="number">1</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 层序遍历</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printTree</span><span class="params">(root *TreeNode)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">	queue := <span class="built_in">make</span>([]*TreeNode, <span class="number">0</span>)</span><br><span class="line">	queue = <span class="built_in">append</span>(queue, root)</span><br><span class="line">	list := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(queue) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		list = <span class="built_in">append</span>(list, queue[<span class="number">0</span>].Val)</span><br><span class="line">		left := queue[<span class="number">0</span>].Left</span><br><span class="line">		right := queue[<span class="number">0</span>].Right</span><br><span class="line">		<span class="keyword">if</span> left != <span class="literal">nil</span> &#123;</span><br><span class="line">			queue = <span class="built_in">append</span>(queue, left)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> right != <span class="literal">nil</span> &#123;</span><br><span class="line">			queue = <span class="built_in">append</span>(queue, right)</span><br><span class="line">		&#125;</span><br><span class="line">		queue = queue[<span class="number">1</span>:]</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Runtime distribution</strong></p>
<blockquote>
<p>Runtime: 24 ms, faster than 86.52% of Go online submissions for Two Sum IV - Input is a BST.</p>
</blockquote>
<p><strong>memory distribution</strong></p>
<blockquote>
<p>Memory Usage: 7.6 MB, less than 50.00% of Go online submissions for Two Sum IV - Input is a BST.</p>
</blockquote>
<p><strong>思考</strong></p>
<blockquote>
<p>通过层序遍历，将二叉搜索树转成数组，然后再通过哈希表法判断是否存在两个数的和等于目标值</p>
</blockquote>
<h4 id="解法二"><a href="#解法二" class="headerlink" title="解法二"></a>解法二</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/01/04/2019-review/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/01/04/2019-review/" class="post-title-link" itemprop="url">2019年个人总结</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-04 00:49:15" itemprop="dateCreated datePublished" datetime="2020-01-04T00:49:15+08:00">2020-01-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 01:04:47" itemprop="dateModified" datetime="2020-04-26T01:04:47+08:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%94%9F%E6%B4%BB/" itemprop="url" rel="index">
                    <span itemprop="name">生活</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>2019年已经过去3天了，再不写个人总结，2020年怕是又要稀里糊涂的过去了。</p>
<p>如果给过去的这一年打个分，自认为能打到70分，算是部分满意。此外，2019年也是我从学校到工作过渡的一年，我是年初1月23号拿的毕业证，直接入职，到年底正好工作一整年。这一年，无论是工作内还是工作外，都有太多值得记录的事情。</p>
<h2 id="回顾2019年初的目标"><a href="#回顾2019年初的目标" class="headerlink" title="回顾2019年初的目标"></a>回顾2019年初的目标</h2><hr>
<p>大方向上，主要有下面几个：</p>
<ul>
<li>给自己和家人配置保险</li>
<li>开始自己的投资规划</li>
<li>学英语（这算是一个执念吧）</li>
<li>练字</li>
<li>提高自己的专业技能</li>
</ul>
<h3 id="给自己和家人配置保险"><a href="#给自己和家人配置保险" class="headerlink" title="给自己和家人配置保险"></a>给自己和家人配置保险</h3><p>一直以来就对保险充满了好感，觉得没有保险的人生是没有安全感的。对保险有好感的原因比较多，首先，我这个人比较怕死。这么多年，无论是亲身经历的，还是从电视新闻上看到的一些和生死相关的事情，都让我对死亡充满了敬畏。很多时候，生命远比我们想象的要脆弱。而保险，能让生命在最脆弱的时候，保留一份基本的尊严；其次是刚买房，家里也没什么积蓄，爸妈年纪都大了，我才刚开始工作，整个家庭的风险承受能力很低。所以，刚工作不到两个月，我就开始不断的看保险相关的知识，比对不同的保险。看的焦头烂额的时候，正好实验室的一个师姐也在了解保险，她的一个高中同学就是大都会的保险代理人。这期间通过这个代理人，了解了医疗险和重疾险的区别，再结合自身的实际情况，配置了如下的保险：</p>
<p><strong>自己</strong>：医疗险+重疾险+恶性肿瘤医疗险（全球版）<br><strong>媳妇</strong>：医疗险+重疾险<br><strong>父母</strong>：好医保-住院医疗险</p>
<p>医疗险是现在比较火的百万医疗险，报销型，保额足够了。重疾险是一份终身10万保额叠加20年期40万保额，一共50万保额。由于实在是担心自己得癌症，自己又加了一份恶性肿瘤医疗险（全球版），两个人全年保费8000左右。父母因为已经到51周岁，年级大了，不适合买重疾险，就再支付宝上买了好医保-住院医疗险，两个人全年保费1500左右。大都会的保险相比其他家的是偏贵了，之所以还选择他们家，是因为保险附带的增值服务比较多。</p>
<p>因为刚开始工作，也没什么积蓄，暂时就先配置这些年，短期内不再变动。等以后收入增加了，再把重疾险的额度配置上去。</p>
<h3 id="开始自己的投资规划"><a href="#开始自己的投资规划" class="headerlink" title="开始自己的投资规划"></a>开始自己的投资规划</h3><p>年初的时候看了不少公众号文章，都在宣传躺着赚钱，财务自由这些让人心里痒痒的观点，再加上之前自己胡乱投资基金、p2p这些，狠狠的踩了几趟雷，决定系统的开始自己的投资之路，万一走着走着就自由了呢？</p>
<p>我的投资学习路径是两部分：</p>
<ul>
<li><strong>理论学习</strong></li>
<li><strong>投资实践</strong></li>
</ul>
<p><strong>理论学习</strong>方面，主要包括财富观的培养、投资基础知识的学习。这一年，完成了以下书籍：</p>
<ul>
<li>傻瓜式投资</li>
<li>穷爸爸和富爸爸</li>
<li>小狗钱钱</li>
<li>指数基金投资指南</li>
<li>解读基金：我的投资观与实践</li>
<li>漫步华尔街</li>
</ul>
<p>未完成书籍：</p>
<ul>
<li>聪明的投资者</li>
<li>共同基金常识</li>
<li>逃不开的经济周期</li>
</ul>
<p>这几本书比较硬核，看的比较慢，2020年继续。</p>
<p><strong>投资实践</strong>方面，从抄作业开始，跟投E大的长赢计划，中途配置了教育基金和自己的养老基金，主要定投沪深300和中证500这两个指数基金。</p>
<p>2019年收益率16%左右，基本是抄作业的功劳，比较满意，所以已有部分继续跟投，同时继续完善理论知识，完成自己的投资体系的建立，然后实现躺尸的同时，躺赢，哈哈~~</p>
<h3 id="专业技能"><a href="#专业技能" class="headerlink" title="专业技能"></a>专业技能</h3><p>这部分进行的一般。由于工作上的变动，从算法转到了开发，自然语言处理和机器学习的学习就彻底搁置了下来。后端开发能力上，跟着业务，狠狠的补了下基础知识。主要的能力提升是对后端开发有了一个整体的认识：后端开发围绕的是数据的存储和在业务逻辑上的处理。</p>
<p>关于后端开发知识，主要的提升在对nginx的了解、redis的了解上，其它的一些提升比较零碎，不成体系。</p>
<h3 id="学英语"><a href="#学英语" class="headerlink" title="学英语"></a>学英语</h3><p>学英语是一直以来的执念，也没有什么具体的目标，就是想学，但是每次都是半途而废。</p>
<p>19年，在水滴上完成了《人性的弱点》和《人性的优点》两本英文原著的半精读，其它就没有了。</p>
<p>20年需要好好梳理下学英语到底是为了什么，需要达到一个什么样的目标，然后再重新定个计划，好好执行。</p>
<h3 id="练字"><a href="#练字" class="headerlink" title="练字"></a>练字</h3><p>想练一手好字。。。19年一直处于想的状态。20年需要定个轻松易行的计划，争取每年提高一些。</p>
<p>以上是19年年初规划的完成情况，整体看，喜忧参半。家庭规划上的完成情况比较满意，但是技能提升相关的规划完成度较差，这部分需要重新梳理一遍，并且制定出一个松紧有度的20年年度计划，希望20年结束的时候，能够完美的交出一份对的起自己的答卷。</p>
<h2 id="2019年感触比较深的几件事"><a href="#2019年感触比较深的几件事" class="headerlink" title="2019年感触比较深的几件事"></a>2019年感触比较深的几件事</h2><hr>
<h3 id="人生大事"><a href="#人生大事" class="headerlink" title="人生大事"></a>人生大事</h3><p>人生大事方面，完成了买房和领证。</p>
<h4 id="买房"><a href="#买房" class="headerlink" title="买房"></a>买房</h4><p>媳妇还在上学，之前研究生入学的时候，没有意识到户口的重要性，就没有把户口转到学校，幸好18年政策变化，除了入学那一次可以迁户口，每年秋季开学也可以迁户口了，就赶紧办理，到19年初户口就下来了。户口下来之后，迅速的把房子给买了。现在回想买房的过程，觉得有点太草率了，有必要记录一下买房的过程，让自己在以后做类似买房这种重大决定的时候，不要被情绪左右。</p>
<p>决定买房之前，和媳妇讨论要买什么样的房子，为了能买到预算范围内最合适的房子，我们首先列出了一系列的考虑因素，最终决定重点看<code>交通</code>，<code>医疗资源</code>，<code>菜市场</code>，<code>公园</code>，<code>商业配套</code> 这几个因素，由于我们都还年轻，再加上预算只有200左右（主要原因），就没有考虑学区房。交通方面，主要是地铁，所以我们以地铁线为基准，列出地铁线上每一站附近的<code>医院</code>，<code>商业配套</code>，<code>公园</code>，<code>学校</code>以及附近<code>房价</code>等情况，并以此筛选出候选站点。我们花了2个星期左右的时间，统计了1、2、3、4、5、6、9这几条地铁线，标出了一些候选，并决定每周末考察两个地铁站。</p>
<p>在4月初的一个周末，我们开始了考察。首先去的是1号线终点附近的几个站点，找了链家的一个中介，带着我们看了附近的几个小区，整体看下来，这一片都是居民区，小区质量一般，配套还行，生活气息浓厚，商业气息差了些，不太满意。晚上临走的时候中介推荐了5号线附近一个新开的楼盘，说是性价比很高，强烈建议我们去看看。我们其实是不太想去的，一是当时有点晚，二是本身也不着急，奈何中介极力推荐，就说第二天去看看。</p>
<blockquote>
<p>我们常常在小钱上斤斤计较，如买菜和买衣服，而在大钱上冲动无比，如买房</p>
</blockquote>
<p>第二天跟着中介到了售楼处，好家伙，里面人声鼎沸，导购介绍和签合同的场景到处都是。在经过了导购员的讲解之后，对楼盘有了个整体印象。一共是两个小区，一大一小，大的小区靠着一个正在建的永旺商场，小的隔的远了些，靠着一个正在建的市民广场。附近就是外环和高速入口，地铁站1公里左右。交通不错，商业配套和生活配套也不错，缺点是都在规划中。价格和预算一致。两个人都比较满意，这个时候导购一直在强调，最近三天搞活动，预付定金，给2个点优惠。两个人都没啥定力，被导购这么一说，再加上对房子确实很满意，都开始犹豫要不要先交定金。和家里商量了下（家里没意见，也都不懂，说只要我们觉得满意就行，唉。。。），又咨询了一个在德佑的亲戚的意见，觉得还行，两个人就在晕乎乎的情况下，交定金了。</p>
<p>晚上回去后，两个人都觉得草率了，但是因为本身对房子比较满意，没有发现什么地方有问题，就商量着真正交首付的时候，一定要仔细的比对合同，同时问明白一些关键指标，如果有什么地方不行，哪怕定金要不回来也不能买。付首付的时候，果然还是出问题了。一是我们发现这个房子没有阳台。当时看房型的时候，都觉得房型很好，方方正正，南北通透，愣是把阳台给漏了。二是问了下公摊，这一问，才知道公摊高达35%，105的房子套内面积才70，瞬间不想定了。后来和在德佑的那个亲戚沟通，他说这个公摊确实是很高了，但是套内面积70的三居也还行，其实套内面积差个2平米根本就感觉不出来。他这么一说，再加上内心清楚，这个房子吸引我的地方有很大一部分原因是旁边正在规划的市民广场，市民广场的规划里面有图书馆，电影院等，这个实在太吸引我了。所以和媳妇商量了好一会，犹豫再三，最终还是付了首付。</p>
<p>进入2020年，回过头来看，买的房子单价降了近2000，市民广场的规划发生变动，广场的一半改成商业配套。房价下降这件事情，4月份其实是有预期的，当时看了很多文章，都在说19年的政策是强调房住不炒，而且目前国家经济处于转型的过程中，经济形式不好，未来一段时间内房价肯定会下跌，所以买房不用着急，但是并没深入的去研究论据，自己只是表面相信，所以在售楼处导购员反复推销的时候，我是如此的不堪一击；另外有一个观点是如果是刚需，随时可以上车。因为4月份的房价相比18年的顶点是降了不少的。现在想来，刚需随时可以上车这句话是理解错了。对当时的自己而言，其实买房并不是刚需，媳妇21年夏天才毕业，我在北京工作，我们暂时是没有住房需求的。市民广场规划发生变化这件事，就是买期房的风险了，幸好规划变化还能接受，希望未来没有大的变动。</p>
<h4 id="领证"><a href="#领证" class="headerlink" title="领证"></a>领证</h4><p>因为买房用的是媳妇的户口，还贷款是我，加上父母不可能同意只以媳妇的名义买房，所以两个人就需要在签贷款合同前领证。由于买房这个决策太突然，导致领证这件事也变的很赶。两个人匆匆忙忙的去拍了结婚照，又急急忙忙的去民政局领了证。</p>
<p>领证的当天，早上8点多就到了民政局。时间比较早，有点冷清，交了材料后，等了一小会，就轮到我们了。填了些材料，不一会，鲜红的两个结婚证就出来了。两个人拿到结婚证后，坐在沙发上缓了好一会，都觉得有点不真实。但因为下午还要赶紧去办贷款，缓过来之后又急急忙忙的去了售楼处。领证的过程就这么匆忙的结束了，都没来的及吃顿饭庆祝一下。</p>
<p>回想起和媳妇相处的这几年，除了最开始的一年里面摩擦较多，后来磨合的越来越好，也不知当初两个人怎么就互相认定了。随着时间的推移，越发能体会到媳妇的好，也越发为自己当时的眼光感到得意。</p>
<p>希望接下来的日子里，两个人能走的越来越好，把我们的小日子过的有滋有味。</p>
<h3 id="工作波折"><a href="#工作波折" class="headerlink" title="工作波折"></a>工作波折</h3><h4 id="部门变动和线上事故"><a href="#部门变动和线上事故" class="headerlink" title="部门变动和线上事故"></a>部门变动和线上事故</h4><p>18年底到19年中这段时间，从实习转成了正式。这段时间里面，先是最初的业务被停掉，换了新业务，之后是部门换掉，从大搜到了手百，再就是经理也换了。中间由于各种原因，指导人换了又换，我也从最初的算法转到了开发。</p>
<p>换到新部门和新业务期间，指导人被重新指定。这段时间里，我刚接手的项目对当时的我来说，难度系数较高。开发的过程中，费了很大劲才能勉强跟上进度。中间有个任务，因为一些原因，需要迁移。由于开始没有能和指导人C有一个比较好的沟通，设计方案做的比较差，线上运行的时候，出了严重的事故。</p>
<p>之后复盘过程中，C不断的指出方案上的不足，告诉我哪些地方需要多加注意，代码评审的时候，也是一行行的过代码，前后评审10多次。短短的几天内，我学到了很多，也很感激。</p>
<p>后来C由于个人发展上的考虑，去了部门内的其他组。我的指导人也从C变成了组内的S。偶尔会想，如果开始的时候，C就能像最后那样，我是不是就不会经历后来的转正风波，当然也就不会迅速认识到工作和学校学习的不同和及时适应身份上的一个转变。凭良心说，C的业务能力很强，人品也没问题，可能是我的性格和他实在不搭，再加上初期的自己确实也有一些问题，导致两个人没能沟通好，这一点比较遗憾。</p>
<h4 id="转正风波"><a href="#转正风波" class="headerlink" title="转正风波"></a>转正风波</h4><p>由于指导人C给的评价不好，给新经理留下一个很差的印象。试用期过了一大半的时候，新的指导人S通知我说我的转正比较危险，让我做好心里准备。当时听到这个，心里顿时一沉。指导人S说他也是第一次遇到这种事情，也不知道怎么处理，建议我做两手准备，而他接下来也会尽量把任务分给我一些，希望我能多一些产出。</p>
<p>后来我主动找经理沟通了下我当前的状态，经理指出了我身上的一些不足，并且说给我一个月左右的观察期，同时指定了一些任务指标，希望我好好表现。这一个月里面，刚好业务上特别忙，又要准备那些任务指标，压力很大。天天晚上都是11点、12多才回去。工作日没有时间完成那些任务指标，只能周六日来弄。</p>
<p>这期间十分感谢指导人S的尽心指导，使得我的业务能力有了很大的提高，从而顺利的通过了转正，以后有机会一定要好好的感谢他；也非常感谢媳妇，在这段时间里面没有给我任何压力，并且不断的鼓励我，让我没有其它的后顾之忧。</p>
<p>转正风波这段期间，虽然说是压力很大，但是也仅此而已。首先是我和媳妇的感情很稳定，其次是虽然有房贷，但是两个人手上有一些钱足够支撑一年，经济上也没有太大压力，再次家里也很和谐。可以说这几个因素是我能顺利通过转正的坚实基础。</p>
<p>工作上的这两件事给刚出学校我很大的冲击，让我迅速的认识到学校学习和社会工作的不同，及时调整自己，同时尽早开始思考自己的人生规划，为将来做准备。可以说是因祸得福。希望以后的自己能不断的提高，能自信的面对任何变化，让自己成为家人坚实的依靠。</p>
<h2 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h2><hr>
<p>2019年已经过去，这一年无论发生了什么，都变成了过去时，只有成长留了下来。人生短暂，希望接下来的日子里，能和时间做朋友，在未来，成为更好的自己！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/07/%E8%AF%81%E5%88%B8%E6%8A%95%E8%B5%84%E7%9A%84%E6%9C%AC%E8%B4%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="tjjsjwhj">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="tjjsjwhj的个人空间~">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2019/07/07/%E8%AF%81%E5%88%B8%E6%8A%95%E8%B5%84%E7%9A%84%E6%9C%AC%E8%B4%A8/" class="post-title-link" itemprop="url">证券投资的本质</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-07-07 23:30:07" itemprop="dateCreated datePublished" datetime="2019-07-07T23:30:07+08:00">2019-07-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-21 16:13:41" itemprop="dateModified" datetime="2020-06-21T16:13:41+08:00">2020-06-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%8A%95%E8%B5%84%E7%90%86%E8%B4%A2/" itemprop="url" rel="index">
                    <span itemprop="name">投资理财</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="A股是赌场吗？"><a href="#A股是赌场吗？" class="headerlink" title="A股是赌场吗？"></a>A股是赌场吗？</h3><p>不同的想法和理念代入到交易中，就有不同的反馈。</p>
<blockquote>
<p>资本市场是一个高度复杂的生态系统，所以从不同的角度观察，就会有不同的看法</p>
</blockquote>
<h4 id="如果把A股看成赌场"><a href="#如果把A股看成赌场" class="headerlink" title="如果把A股看成赌场"></a>如果把A股看成赌场</h4><p>赌场有个显著的特点：总价值不变，有赢就有输。</p>
<p>如果把A股看成赌场，双方博弈的对象就是股票的价格，看涨的买入，看跌的卖出。</p>
<p>如果把A股看成赌场，A股有80%的公司都是没有价值的公司(牌本身没有价值，只有在比大小的时候才有相对价值。所以公司是没有价值的，猜股票的涨跌才是有价值的。当然还是有20%的公司无法忽略，他就是有价值的）</p>
<p>不建议用赌场的观念看待A股：垃圾股的估值整体处在一个向下回归的过程中，这时候进行纯粹的博弈就不行了。</p>
<h4 id="如果认为A股不是赌场"><a href="#如果认为A股不是赌场" class="headerlink" title="如果认为A股不是赌场"></a>如果认为A股不是赌场</h4><p>A股依然有很多公司在为投资者创造价值。那么可以通过分享上市公司的增长获得价值的增值。</p>
<h3 id="格雷厄姆的看法"><a href="#格雷厄姆的看法" class="headerlink" title="格雷厄姆的看法"></a>格雷厄姆的看法</h3><p>投资是一种通过认真分析研究，有希望保本和获得满意收益的行为，不满足这些条件的行为就是投机。</p>
<h4 id="内在价值"><a href="#内在价值" class="headerlink" title="内在价值"></a>内在价值</h4><p>要根据公司的内在价值来投资，而不是根据市场的波动来投资。股票应该是公司的部分所有权，而不应该是日常价格变动的证明。</p>
<p>证券投资, 买的是企业所有权的一部分，买的是企业未来盈利的一部分。</p>
<p>内在价值不能简单的看做是公司的资产总额减去负债总额，还包括这些资产未来所能产生的收益。</p>
<h4 id="市场先生"><a href="#市场先生" class="headerlink" title="市场先生"></a>市场先生</h4><p>市场先生如果过于乐观，就会报出一个特别高的价格，如果过于悲观，就会报出一个特别低的价格。</p>
<p>市场先生从不害怕无人理会，如果今天他的报价无人理会，那么明天，他就会报出一个更低的价格。相反，如果理会的人太多，那么第二天，他就会报出一个更高的价格。</p>
<p>市场先生的情绪越是狂躁抑郁，对你越有利。如果你的情绪受到他的左右，那么后果不堪设想。</p>
<p>对我们有用的，是市场先生口袋里的报价单，而不是他的智慧。如果你不能确定远比市场先生更了解而且更能估价你的企业，那么你就没有资格玩这个游戏。</p>
<p><em>格雷厄姆的选股方法：三分之二市净率和低市盈率，倾向于找便宜的公司</em><br><em>需要注意这种方法的时代背景：1929年的大萧条，便宜的公司遍地都是</em></p>
<h4 id="安全边际"><a href="#安全边际" class="headerlink" title="安全边际"></a>安全边际</h4><p>投资者应该在他愿意付出的价格和他估计出的股票价值之间保持一个较大的差价，这个差价就叫做安全边际。</p>
<h3 id="巴菲特对格雷厄姆价值投资理论的发展"><a href="#巴菲特对格雷厄姆价值投资理论的发展" class="headerlink" title="巴菲特对格雷厄姆价值投资理论的发展"></a>巴菲特对格雷厄姆价值投资理论的发展</h3><h4 id="继承部分"><a href="#继承部分" class="headerlink" title="继承部分"></a>继承部分</h4><ul>
<li>持有股票即持有公司</li>
<li>投资和投机的定义和区别</li>
<li>市场先生</li>
<li>安全边际</li>
<li>各种套利方法和捡烟蒂理论</li>
</ul>
<h4 id="抛弃部分"><a href="#抛弃部分" class="headerlink" title="抛弃部分"></a>抛弃部分</h4><ul>
<li>55股债平衡理论</li>
<li>用市净率和市盈率等简单指标去买一堆看似便宜的公司</li>
<li>只依据财报看资产价值而不看未来价值</li>
</ul>
<h4 id="发展部分"><a href="#发展部分" class="headerlink" title="发展部分"></a>发展部分</h4><ul>
<li>护城河、能力圈、管理层等结合概率思维预测公司前景的准确性</li>
<li>好公司普通价格优于普通公司好价格</li>
<li>按机会成本行事</li>
<li>内在价值等于未来现金流折现</li>
<li>伯克希尔模式，充分发挥资本的边际效应</li>
<li>利用保险公司的低成本</li>
</ul>
<p><em>巴菲特的看法：价格公道的伟大企业要比价格低廉的普通企业要好得多</em></p>
<h3 id="几种定义方式和理解"><a href="#几种定义方式和理解" class="headerlink" title="几种定义方式和理解"></a>几种定义方式和理解</h3><p>价格低于价值情况，所有的投资都应该叫做价值投资</p>
<p>相对于成长股而言，买的公司要有相应的资产，利润，和现金流，而不是靠未来成长的可能性来支撑起价值。（更为现在的投资者所接受）</p>
<p>价值投资是资产管理者的信仰，趋势交易等理念更多的是作为一种投资工具在使用。择时已经被成熟的市场所抛弃，大量产品禁止择时。</p>
<p>在中国，价值投资的便签已经被滥用。有人股票被套了，就说自己是长期持有，价值投资；有人买了消费股，买了大蓝筹，大盘股，行业龙头，就说自己是价值投资；有人认为，只有买低市盈率、市净率的股票才是价值投资。</p>
<p>一种观点：是不是价值投资，重点看投资回报的来源是哪？如果是企业的持续盈利增长，投资人去分享红利，这才是价值投资的方式，才是基于基本面的投资.</p>
<h4 id="涉及到的一些概念"><a href="#涉及到的一些概念" class="headerlink" title="涉及到的一些概念"></a>涉及到的一些概念</h4><ul>
<li>低估值、高回报<ul>
<li>价值投资不等于长期持有，</li>
</ul>
</li>
<li>短、中、长期的有趣定义<ul>
<li>用时间划分长短没错，但是没有意义，持有期限是结果，不是目的，要根据操作内涵来理解</li>
<li>短线就是尊重市场，顺势而为，重点是不亏损，盈利没有要求</li>
<li>中线需要对基本面有很高的掌握，对价格估值系统有充分的认识，他的标的物是那些经营相对稳定，没有大起大落的企业，讲究的是低买高卖，预期盈利目标到20%才可入场，8%的止损位</li>
<li>长线的要求最高，要求对企业有很深的认识，对自己有严格的控制，清楚把握企业未来发展的趋势，以投资的心态分享企业未来的成长。他的投资标的物是千里挑一，他对利润的要求是数以十倍计，在这样的机会面前，他不会惧怕任何亏损，不会设置除基本面以外的任何止损指标</li>
</ul>
</li>
<li>看长做短<ul>
<li>A股由于波动较大，常常3个月把三年的涨幅都涨完，这种情况就大大透支了企业的基本面，这种时候就需要及时兑现利润。适合A股的一种策略就是看长做短，但是这个短一定是作为结果，而不是作为目的。看长的意思是，你买入的行业或者板块，一定要有一年以上，偏中长期的投资逻辑，而不能是仅仅几个月的利好，持有计划应该是一年以上，做短是如果短期上涨太快，要注意止盈。</li>
</ul>
</li>
</ul>
<p><strong>仅以时间作为策略区分标准的一定会走入误区，决定策略的仅应该是股票本身的不同和投资者自身的素质</strong></p>
<h3 id="理论基础的重要性"><a href="#理论基础的重要性" class="headerlink" title="理论基础的重要性"></a>理论基础的重要性</h3><pre><code>1. 价值投资：知和行的关系
2. 胜者为王，宁可错过，不要做错
3. 做好价值投资，保持健康</code></pre><p><strong>投资是艺术，不是科学</strong></p>
<p><strong><a href="https://pc-shop.xiaoe-tech.com/appCRApuVG28915/video_details?id=v_5c4142617c5d9_e6jBxu1Y" target="_blank" rel="noopener">视频地址</a></strong> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">tjjsjwhj</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tjjsjwhj" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tjjsjwhj" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:tjjsjwhj@126.com" title="E-Mail → mailto:tjjsjwhj@126.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tjjsjwhj</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
